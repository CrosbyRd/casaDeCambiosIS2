{% extends "base.html" %}
{% block title %}Global Exchange{% endblock %}

{% block content %}
<main class="max-w-5xl mx-auto px-6 py-10">

  <!-- Encabezado -->
  <header class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-4xl font-extrabold mb-2 text-[var(--ink)]">ü™ô Crear Moneda</h1>
      <p class="text-lg leading-relaxed max-w-2xl text-[var(--muted)]">
        Completa el formulario para registrar una nueva moneda en el sistema.
      </p>
    </div>
    <a href="{% url 'monedas:listar_monedas' %}"
       class="px-4 py-2 rounded-lg font-bold bg-[var(--brand-soft)] hover:brightness-95"
       style="color:var(--brand-dark)">‚¨Ö Volver</a>
  </header>

  <!-- Formulario -->
  <section class="bg-white border rounded-xl shadow-sm mb-4" style="border-color:var(--line)">
    <form method="post" id="moneda-form" class="pb-6"
          data-currencies='{
            "USD":{"name":"D√≥lar estadounidense","symbol":"$","emoji":"üá∫üá∏"},
            "EUR":{"name":"Euro","symbol":"‚Ç¨","emoji":"üá™üá∫"},
            "ARS":{"name":"Peso argentino","symbol":"$","emoji":"üá¶üá∑"},
            "BRL":{"name":"Real brasile√±o","symbol":"R$","emoji":"üáßüá∑"},
            "CLP":{"name":"Peso chileno","symbol":"$","emoji":"üá®üá±"},
            "COP":{"name":"Peso colombiano","symbol":"$","emoji":"üá®üá¥"},
            "MXN":{"name":"Peso mexicano","symbol":"$","emoji":"üá≤üáΩ"},
            "PEN":{"name":"Sol peruano","symbol":"S/","emoji":"üáµüá™"},
            "PYG":{"name":"Guaran√≠ paraguayo","symbol":"‚Ç≤","emoji":"üáµüáæ"},
            "UYU":{"name":"Peso uruguayo","symbol":"$","emoji":"üá∫üáæ"},
            "GBP":{"name":"Libra esterlina","symbol":"¬£","emoji":"üá¨üáß"},
            "JPY":{"name":"Yen japon√©s","symbol":"¬•","emoji":"üáØüáµ"},
            "CNY":{"name":"Yuan chino","symbol":"¬•","emoji":"üá®üá≥"},
            "AUD":{"name":"D√≥lar australiano","symbol":"$","emoji":"üá¶üá∫"},
            "CAD":{"name":"D√≥lar canadiense","symbol":"$","emoji":"üá®üá¶"},
            "CHF":{"name":"Franco suizo","symbol":"Fr","emoji":"üá®üá≠"}
          }'>
      {% csrf_token %}

      <!-- C√≥digo (bloque superior redondeado) -->
      <div class="overflow-x-auto">
        <div class="w-full min-w-[560px] rounded-xl overflow-hidden border" style="border-color:var(--line)">
          <table class="w-full border-collapse">
            <thead class="bg-[var(--brand)] text-white">
              <tr><th class="px-4 py-3 text-left">C√≥digo</th></tr>
            </thead>
            <tbody>
              <tr class="hover:bg-[var(--brand-soft)] bg-white">
                <td class="px-4 py-3">
                  {{ form.codigo }}
                  {% if form.codigo.errors %}
                    <div class="mt-2 px-3 py-2 rounded-md border border-red-200 bg-red-50 text-red-700">
                      ‚ö†Ô∏è Ya existe una moneda con ese c√≥digo.
                    </div>
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Nombre / S√≠mbolo -->
      <div class="overflow-x-auto mt-6">
        <table class="w-full border-collapse min-w-[560px]">
          <colgroup>
            <col style="width:50%">
            <col style="width:50%">
          </colgroup>
          <thead class="bg-[var(--brand)] text-white">
            <tr>
              <th class="px-4 py-3 text-left">Nombre</th>
              <th class="px-4 py-3 text-left">S√≠mbolo</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hover:bg-[var(--brand-soft)]">
              <td class="px-4 py-3 align-middle"><div class="w-[380px]">{{ form.nombre }}</div></td>
              <td class="px-4 py-3 align-middle"><div class="w-[380px]">{{ form.simbolo }}</div></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Decimales / M√≠nima denominaci√≥n -->
      <div class="overflow-x-auto mt-6">
        <table class="w-full border-collapse min-w-[560px]">
          <colgroup>
            <col style="width:50%">
            <col style="width:50%">
          </colgroup>
          <thead class="bg-[var(--brand)] text-white">
            <tr>
              <th class="px-4 py-3 text-left">Decimales</th>
              <th class="px-4 py-3 text-left">M√≠nima denominaci√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hover:bg-[var(--brand-soft)]">
              <td class="px-4 py-3 align-middle"><div class="w-[380px]">{{ form.decimales }}</div></td>
              <td class="px-4 py-3 align-middle"><div class="w-[380px]">{{ form.minima_denominacion }}</div></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- (Bloque de flags eliminado a pedido) -->

    </form>
  </section>

  <!-- Botones -->
  <div class="flex justify-end gap-3 pt-2">
    <a href="{% url 'monedas:listar_monedas' %}"
       class="px-4 py-2 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700">
      Cancelar
    </a>
    <button type="submit" form="moneda-form"
            class="px-6 py-2 rounded-lg font-bold text-white shadow-sm"
            style="background:var(--brand)">
      ‚ûï Crear Moneda
    </button>
  </div>
</main>

<style>
  #id_codigo,#id_nombre,#id_simbolo,#id_decimales,#id_minima_denominacion{
    width:100%;max-width:380px;background:#fff;border:1.5px solid var(--line);
    border-radius:12px;padding:12px 14px;height:48px;font-size:1rem;color:var(--ink);
    box-shadow:0 1px 2px rgba(0,0,0,.03);transition:box-shadow .2s,border-color .2s;
  }
  #id_codigo:focus,#id_nombre:focus,#id_simbolo:focus,#id_decimales:focus,#id_minima_denominacion:focus{
    outline:none;border-color:var(--brand);box-shadow:0 0 0 3px rgba(115,60,255,.15);
  }
</style>

<script>
  (function(){
    const form = document.getElementById('moneda-form');
    if(!form) return;

    const data = JSON.parse(form.dataset.currencies || "{}");
    const sel   = document.getElementById('id_codigo');
    const name  = document.getElementById('id_nombre');
    const sym   = document.getElementById('id_simbolo');

    function sync(code){
      if(!data[code]) return;
      const {name: n, symbol} = data[code];
      if(name) name.value = n;
      if(sym)  sym.value  = symbol;
    }
    if(sel && sel.value) sync(sel.value);
    if(sel) sel.addEventListener('change', e => sync(e.target.value));
  })();
</script>
{% endblock %}
