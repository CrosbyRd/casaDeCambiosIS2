{% extends "base.html" %}
{% block title %}Global Exchange{% endblock %}

{% block content %}
<main class="max-w-5xl mx-auto px-6 py-10">

  <!-- Encabezado -->
  <header class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-4xl font-extrabold mb-2 text-[var(--ink)]">ü™ô Editar Moneda</h1>
      <p class="text-lg leading-relaxed max-w-2xl text-[var(--muted)]">
        Modifica la informaci√≥n de la moneda seleccionada y guarda los cambios.
      </p>
    </div>
    <a href="{% url 'monedas:listar_monedas' %}"
       class="px-4 py-2 rounded-lg font-bold bg-[var(--brand-soft)] hover:brightness-95"
       style="color:var(--brand-dark)">‚¨Ö Volver</a>
  </header>

  <!-- Formulario -->
  <section class="bg-white border rounded-xl shadow-sm mb-4" style="border-color:var(--line)">
    <form method="post" id="moneda-form" class="pb-6"
          data-currencies='{
            "USD":{"name":"D√≥lar estadounidense","symbol":"$","emoji":"üá∫üá∏"},
            "EUR":{"name":"Euro","symbol":"‚Ç¨","emoji":"üá™üá∫"},
            "ARS":{"name":"Peso argentino","symbol":"$","emoji":"üá¶üá∑"},
            "BRL":{"name":"Real brasile√±o","symbol":"R$","emoji":"üáßüá∑"},
            "CLP":{"name":"Peso chileno","symbol":"$","emoji":"üá®üá±"},
            "COP":{"name":"Peso colombiano","symbol":"$","emoji":"üá®üá¥"},
            "MXN":{"name":"Peso mexicano","symbol":"$","emoji":"üá≤üáΩ"},
            "PEN":{"name":"Sol peruano","symbol":"S/","emoji":"üáµüá™"},
            "PYG":{"name":"Guaran√≠ paraguayo","symbol":"‚Ç≤","emoji":"üáµüáæ"},
            "UYU":{"name":"Peso uruguayo","symbol":"$","emoji":"üá∫üáæ"},
            "GBP":{"name":"Libra esterlina","symbol":"¬£","emoji":"üá¨üáß"},
            "JPY":{"name":"Yen japon√©s","symbol":"¬•","emoji":"üáØüáµ"},
            "CNY":{"name":"Yuan chino","symbol":"¬•","emoji":"üá®üá≥"},
            "AUD":{"name":"D√≥lar australiano","symbol":"$","emoji":"üá¶üá∫"},
            "CAD":{"name":"D√≥lar canadiense","symbol":"$","emoji":"üá®üá¶"},
            "CHF":{"name":"Franco suizo","symbol":"Fr","emoji":"üá®üá≠"}
          }'>
      {% csrf_token %}

      <!-- C√≥digo (bloqueado) -->
      <div class="overflow-x-auto">
        <table class="w-full border-collapse min-w-[560px]">
          <thead class="bg-[var(--brand)] text-white">
            <tr><th class="px-4 py-3 text-left">C√≥digo</th></tr>
          </thead>
          <tbody>
            <tr class="hover:bg-[var(--brand-soft)]">
              <td class="px-4 py-3">
                {{ form.codigo }}
                <input type="hidden" name="{{ form.codigo.name }}" value="{{ form.codigo.value|default_if_none:'' }}">
                <p class="text-sm text-[var(--muted)] mt-2">El c√≥digo no puede modificarse aqu√≠.</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Nombre / S√≠mbolo -->
      <div class="overflow-x-auto mt-6">
        <table class="w-full border-collapse min-w-[560px]">
          <thead class="bg-[var(--brand)] text-white">
            <tr>
              <th class="px-4 py-3 text-left">Nombre</th>
              <th class="px-4 py-3 text-left">S√≠mbolo</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hover:bg-[var(--brand-soft)]">
              <td class="px-4 py-3">{{ form.nombre }}</td>
              <td class="px-4 py-3">{{ form.simbolo }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Decimales / M√≠nima denominaci√≥n -->
      <div class="overflow-x-auto mt-6">
        <table class="w-full border-collapse min-w-[560px]">
          <thead class="bg-[var(--brand)] text-white">
            <tr>
              <th class="px-4 py-3 text-left">Decimales</th>
              <th class="px-4 py-3 text-left">M√≠nima denominaci√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hover:bg-[var(--brand-soft)]">
              <td class="px-4 py-3">{{ form.decimales }}</td>
              <td class="px-4 py-3">{{ form.minima_denominacion }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Flags -->
      <div class="overflow-x-auto mt-6">
        <table class="w-full border-collapse min-w-[560px]">
          <thead class="bg-[var(--brand)] text-white">
            <tr>
              <th class="px-4 py-3 text-left">Admite en l√≠nea</th>
              <th class="px-4 py-3 text-left">Admite terminal</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hover:bg-[var(--brand-soft)]">
              <td class="px-4 py-3">{{ form.admite_en_linea }}</td>
              <td class="px-4 py-3">{{ form.admite_terminal }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </form>
  </section>

  <!-- Botones fuera del recuadro -->
  <div class="flex justify-end gap-3 pt-2">
    <a href="{% url 'monedas:listar_monedas' %}"
       class="px-4 py-2 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700">
      Cancelar
    </a>
    <button type="submit" form="moneda-form"
            class="px-6 py-2 rounded-lg font-bold text-white shadow-sm"
            style="background:var(--brand)">
      üíæ Guardar Cambios
    </button>
  </div>
</main>

<style>
  #id_codigo,
  #id_nombre,
  #id_simbolo,
  #id_decimales,
  #id_minima_denominacion{
    width:100%;
    max-width:380px;
    background:#fff;
    border:1.5px solid var(--line);
    border-radius:12px;
    padding:12px 14px;
    height:48px;
    font-size:1rem;
    color:var(--ink);
    box-shadow:0 1px 2px rgba(0,0,0,.03);
    transition:box-shadow .2s ease,border-color .2s ease;
  }
  #id_codigo[disabled]{ opacity:.7; cursor:not-allowed; background:#f7f7fb; }
  #id_codigo:focus,
  #id_nombre:focus,
  #id_simbolo:focus,
  #id_decimales:focus,
  #id_minima_denominacion:focus{
    outline:none; border-color:var(--brand);
    box-shadow:0 0 0 3px rgba(115,60,255,.15);
  }
</style>

<script>
  (function(){
    const form   = document.getElementById('moneda-form');
    if(!form) return;

    const data   = JSON.parse(form.dataset.currencies || "{}");
    const sel    = document.getElementById('id_codigo');
    const nombre = document.getElementById('id_nombre');
    const simb   = document.getElementById('id_simbolo');

    if (sel) {
      sel.setAttribute('disabled', 'disabled');
      sel.setAttribute('title', 'El c√≥digo no puede modificarse en edici√≥n.');
    }

    function sync(code){
      if(!data[code]) return;
      const {name, symbol} = data[code];
      if(nombre) nombre.value = name;
      if(simb)   simb.value   = symbol;
    }

    if (sel && sel.value) sync(sel.value);
  })();
</script>
{% endblock %}
