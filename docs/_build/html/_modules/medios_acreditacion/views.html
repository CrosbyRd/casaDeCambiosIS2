

<!DOCTYPE html>
<html class="writer-html5" lang="es" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>medios_acreditacion.views &mdash; documentación de CasaDeCambioIS2 Documentation - </title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=e2bb6099"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/translations.js?v=f85f4cfb"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CasaDeCambioIS2 Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">casaDeCambiosIS2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notificaciones.html">paquete notificaciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simuladores.html">paquete simuladores</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CasaDeCambioIS2 Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Código de módulo</a></li>
      <li class="breadcrumb-item active">medios_acreditacion.views</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Código fuente para medios_acreditacion.views</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Vistas de la aplicación **medios_acreditacion**.</span>

<span class="sd">.. module:: medios_acreditacion.views</span>
<span class="sd">   :synopsis: Gestión de tipos de medios de acreditación y medios asociados a clientes.</span>

<span class="sd">Este módulo implementa las vistas basadas en clases para administrar</span>
<span class="sd">los **tipos de medios de acreditación** (sección administrativa) y los</span>
<span class="sd">**medios de acreditación de clientes** (sección cliente).</span>
<span class="sd">Incluye control de permisos, manejo de formsets y operaciones CRUD</span>
<span class="sd">con notificaciones al usuario.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">messages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse_lazy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">,</span> <span class="n">DeleteView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">inlineformset_factory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">method_decorator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.mixins</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoginRequiredMixin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">usuarios.mixins</span><span class="w"> </span><span class="kn">import</span> <span class="n">RequireClienteMixin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseBadRequest</span><span class="p">,</span> <span class="n">HttpResponseForbidden</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_object_or_404</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TipoMedioAcreditacion</span><span class="p">,</span>
    <span class="n">CampoMedioAcreditacion</span><span class="p">,</span>
    <span class="n">MedioAcreditacionCliente</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.forms</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TipoMedioForm</span><span class="p">,</span>
    <span class="n">CampoMedioForm</span><span class="p">,</span>
    <span class="n">MedioAcreditacionClienteForm</span><span class="p">,</span>
<span class="p">)</span>



<span class="c1"># ===== Mixin de acceso solo admin de esta sección =====</span>
<div class="viewcode-block" id="AccessMediosAcreditacionMixin">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.AccessMediosAcreditacionMixin">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AccessMediosAcreditacionMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mixin de control de acceso para la sección administrativa de medios de acreditación.</span>

<span class="sd">        Requiere que el usuario esté autenticado y posea el permiso</span>
<span class="sd">        ``medios_acreditacion.access_medios_acreditacion``.</span>

<span class="sd">        **Atributos**</span>
<span class="sd">        -------------</span>
<span class="sd">        required_permission : str</span>
<span class="sd">            El permiso necesario para permitir el acceso.</span>

<span class="sd">        **Métodos**</span>
<span class="sd">        -----------</span>
<span class="sd">        dispatch(request, *args, **kwargs) -&gt; HttpResponse or HttpResponseRedirect</span>
<span class="sd">            Verifica que el usuario esté autenticado (por medio de @login_required)</span>
<span class="sd">            y posea el permiso `required_permission`. Si no lo tiene, redirige a la vista &quot;home&quot;.</span>
<span class="sd">            En caso contrario, delega al método dispatch de la clase base.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">required_permission</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion.access_medios_acreditacion&quot;</span>

<div class="viewcode-block" id="AccessMediosAcreditacionMixin.dispatch">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.AccessMediosAcreditacionMixin.dispatch">[documentos]</a>
    <span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required_permission</span><span class="p">):</span>
            <span class="c1"># mismo comportamiento que tus otras apps: fuera -&gt; home</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;home&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>


<span class="c1"># =====================================================</span>
<span class="c1"># Formset inline: Campos dentro de un Tipo de Medio</span>
<span class="c1"># (UN SOLO FORMSET para crear y editar; siempre con can_delete=True)</span>
<span class="c1"># =====================================================</span>
<span class="n">CampoFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span>
    <span class="n">parent_model</span><span class="o">=</span><span class="n">TipoMedioAcreditacion</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">CampoMedioAcreditacion</span><span class="p">,</span>
    <span class="n">form</span><span class="o">=</span><span class="n">CampoMedioForm</span><span class="p">,</span>
    <span class="n">extra</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>          <span class="c1"># 👈 SIN fila vacía automática</span>
    <span class="n">can_delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># =====================================================</span>
<span class="c1"># VISTAS PARA TIPOS DE MEDIO (admin)</span>
<span class="c1"># =====================================================</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formset inline para administrar instancias de :class:`CampoMedioAcreditacion`</span>
<span class="sd">    relacionadas con un :class:`TipoMedioAcreditacion`.</span>

<span class="sd">    Se utiliza en las vistas de creación y edición de tipos de medio.</span>

<span class="sd">    **Opciones principales**</span>
<span class="sd">    ------------------------</span>
<span class="sd">    - ``extra = 0``: no genera filas vacías automáticamente.</span>
<span class="sd">    - ``can_delete = True``: permite marcar instancias para borrado.</span>
<span class="sd">&quot;&quot;&quot;</span>
<div class="viewcode-block" id="TipoMedioListView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioListView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TipoMedioListView</span><span class="p">(</span><span class="n">AccessMediosAcreditacionMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vista para listar los tipos de medios de acreditación (administración).</span>

<span class="sd">        Requiere permiso administrativo (hereda AccessMediosAcreditacionMixin).</span>

<span class="sd">        **Atributos**</span>
<span class="sd">        -------------</span>
<span class="sd">        model : Modelo</span>
<span class="sd">            Modelo asociado: :class:`TipoMedioAcreditacion`.</span>
<span class="sd">        template_name : str</span>
<span class="sd">            Ruta del template: &quot;medios_acreditacion/tipos_list.html&quot;.</span>
<span class="sd">        context_object_name : str</span>
<span class="sd">            Nombre del objeto en el contexto de plantilla: &quot;tipos&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">TipoMedioAcreditacion</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/tipos_list.html&quot;</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s2">&quot;tipos&quot;</span></div>



<div class="viewcode-block" id="TipoMedioCreateView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioCreateView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TipoMedioCreateView</span><span class="p">(</span><span class="n">AccessMediosAcreditacionMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vista para crear un nuevo tipo de medio de acreditación, junto con sus campos asociados.</span>

<span class="sd">        Se apoya en un formset inline (CampoFormSet) para definir múltiples campos en el mismo formulario.</span>

<span class="sd">        **Atributos**</span>
<span class="sd">        -------------</span>
<span class="sd">        model : Modelo</span>
<span class="sd">            Modelo asociado: :class:`TipoMedioAcreditacion`.</span>
<span class="sd">        form_class : Formulario</span>
<span class="sd">            Formulario principal: :class:`TipoMedioForm`.</span>
<span class="sd">        template_name : str</span>
<span class="sd">            Template: &quot;medios_acreditacion/tipos_form.html&quot;.</span>
<span class="sd">        success_url : str</span>
<span class="sd">            URL a la que redirigir tras exitoso guardado: reverse_lazy(&quot;medios_acreditacion:tipos_list&quot;).</span>

<span class="sd">        **Métodos**</span>
<span class="sd">        -----------</span>
<span class="sd">        get_context_data(**kwargs) -&gt; dict</span>
<span class="sd">            Agrega el formset al contexto y una clave &quot;accion&quot; con valor &quot;crear&quot;.</span>

<span class="sd">        form_valid(form) -&gt; HttpResponseRedirect or HttpResponse</span>
<span class="sd">            - Guarda el objeto padre (tipo de medio).</span>
<span class="sd">            - Reconstruye el formset con esa instancia.</span>
<span class="sd">            - Valida el formset.</span>
<span class="sd">            - Si hay errores: muestra mensajes de error y re-renderiza con el formset con errores.</span>
<span class="sd">            - Si es válido: guarda los objetos, marca `activo = True`, borra los eliminados, muestra mensaje éxito,</span>
<span class="sd">            y redirige a `success_url`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">TipoMedioAcreditacion</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">TipoMedioForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/tipos_form.html&quot;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">&quot;medios_acreditacion:tipos_list&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TipoMedioCreateView.get_context_data">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioCreateView.get_context_data">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># en GET y en POST previo al guardado del padre, sin instance</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;formset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CampoFormSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;accion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;crear&quot;</span>
        <span class="k">return</span> <span class="n">context</span></div>


<div class="viewcode-block" id="TipoMedioCreateView.form_valid">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioCreateView.form_valid">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="c1"># 1) Guardar el padre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># 2) RECONSTRUIR el formset con instance=self.object y los mismos POST/FILES</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">CampoFormSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>

        <span class="c1"># 3) Validar el formset ya sobre la instancia correcta</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;Revisá los campos: hay errores en la definición de campos.&quot;</span><span class="p">)</span>
            <span class="c1"># Re-render con el formset rearmado (para mostrar errores)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">))</span>

        <span class="c1"># 4) Guardar (en crear podés eliminar realmente los marcados con DELETE)</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="c1"># por si acaso</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">tipo_medio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">activo</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Borrar los marcados</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">deleted_objects</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;Tipo de medio y campos creados correctamente ✅&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success_url</span><span class="p">)</span></div>
</div>


    
    

<div class="viewcode-block" id="TipoMedioUpdateView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioUpdateView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TipoMedioUpdateView</span><span class="p">(</span><span class="n">AccessMediosAcreditacionMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vista para editar un tipo de medio de acreditación existente, junto con sus campos asociados.</span>

<span class="sd">        Mantiene los campos existentes, permite borrado lógico y reactivación.</span>

<span class="sd">        **Atributos**</span>
<span class="sd">        -------------</span>
<span class="sd">        model : Modelo</span>
<span class="sd">            :class:`TipoMedioAcreditacion`</span>
<span class="sd">        form_class : Formulario</span>
<span class="sd">            :class:`TipoMedioForm`</span>
<span class="sd">        template_name : str</span>
<span class="sd">            Template: &quot;medios_acreditacion/tipos_form.html&quot;</span>
<span class="sd">        success_url : str</span>
<span class="sd">            URL de redirección tras éxito.</span>

<span class="sd">        **Métodos**</span>
<span class="sd">        -----------</span>
<span class="sd">        get_context_data(**kwargs) -&gt; dict</span>
<span class="sd">            Crea el formset ya sea con datos POST o con la instancia existente para edición,</span>
<span class="sd">            agrega clave &quot;accion&quot; = &quot;editar&quot;.</span>

<span class="sd">        form_valid(form) -&gt; HttpResponseRedirect or HttpResponse</span>
<span class="sd">            - Valida el formset; si hay errores, construye mensajes con el índice de fila.</span>
<span class="sd">            - Guarda primero el tipo de medio.</span>
<span class="sd">            - Obtiene instancias del formset (commit=False) y las guarda, asignando tipo_medio.</span>
<span class="sd">            - Marca los objetos “eliminados” como `activo = False` en vez de borrarlos.</span>
<span class="sd">            - Reactiva las instancias que estaban inactivas y no fueron marcadas como DELETE.</span>
<span class="sd">            - Muestra mensaje éxito y redirige.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">model</span> <span class="o">=</span> <span class="n">TipoMedioAcreditacion</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">TipoMedioForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/tipos_form.html&quot;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">&quot;medios_acreditacion:tipos_list&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TipoMedioUpdateView.get_context_data">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioUpdateView.get_context_data">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s2">&quot;formset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CampoFormSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s2">&quot;formset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CampoFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;accion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;editar&quot;</span>
        <span class="k">return</span> <span class="n">context</span></div>


<div class="viewcode-block" id="TipoMedioUpdateView.form_valid">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioUpdateView.form_valid">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">()</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;formset&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Fila </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;Revisá los campos: hay errores en la definición de campos.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">))</span>

        <span class="c1"># Guardar primero el Tipo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># 1) Crear/actualizar (sin borrar aún)</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">tipo_medio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
            <span class="c1"># si es nuevo, por defecto activo</span>
            <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">pk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">activo</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># 2) Desactivar: los marcados como DELETE</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">deleted_objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">activo</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># 3) **Reactivar**: formularios existentes que NO están en DELETE</span>
        <span class="c1">#    y cuya instancia actual está inactiva.</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">instance</span>
            <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
                <span class="c1"># Si el form tiene el campo DELETE (lo tiene en inline formset):</span>
                <span class="n">marked_delete</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">activo</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">marked_delete</span><span class="p">:</span>
                    <span class="n">inst</span><span class="o">.</span><span class="n">activo</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;Tipo de medio y campos actualizados correctamente ✏️&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success_url</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TipoMedioDeleteView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioDeleteView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TipoMedioDeleteView</span><span class="p">(</span><span class="n">AccessMediosAcreditacionMixin</span><span class="p">,</span> <span class="n">DeleteView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vista para eliminar un tipo de medio de acreditación.</span>

<span class="sd">    Presenta una confirmación y luego ejecuta el borrado.</span>

<span class="sd">    **Atributos**</span>
<span class="sd">    -------------</span>
<span class="sd">    model : Modelo</span>
<span class="sd">        :class:`TipoMedioAcreditacion`</span>
<span class="sd">    template_name : str</span>
<span class="sd">        Template de confirmación: &quot;medios_acreditacion/tipos_confirm_delete.html&quot;</span>
<span class="sd">    success_url : str</span>
<span class="sd">        URL de redirección tras la eliminación: lista de tipos.</span>

<span class="sd">    **Métodos**</span>
<span class="sd">    -----------</span>
<span class="sd">    delete(request, *args, **kwargs) -&gt; HttpResponseRedirect</span>
<span class="sd">        Al borrar, muestra mensaje de éxito, luego delega al método `delete`</span>
<span class="sd">        de la clase base.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">TipoMedioAcreditacion</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/tipos_confirm_delete.html&quot;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">&quot;medios_acreditacion:tipos_list&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TipoMedioDeleteView.delete">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.TipoMedioDeleteView.delete">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;Tipo de medio eliminado correctamente ❌&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>


<span class="c1"># =====================================================</span>
<span class="c1"># VISTAS PARA MEDIOS DE CLIENTES (lado cliente)</span>
<span class="c1"># =====================================================</span>
<div class="viewcode-block" id="MedioClienteListView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteListView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MedioClienteListView</span><span class="p">(</span><span class="n">RequireClienteMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vista para listar los medios de acreditación asociados a un cliente logueado.</span>

<span class="sd">    Requiere que el usuario corresponda a un cliente (RequireClienteMixin).</span>

<span class="sd">    **Atributos**</span>
<span class="sd">    -------------</span>
<span class="sd">    model : Modelo</span>
<span class="sd">        :class:`MedioAcreditacionCliente`</span>
<span class="sd">    template_name : str</span>
<span class="sd">        Template: &quot;medios_acreditacion/clientes_list.html&quot;</span>
<span class="sd">    context_object_name : str</span>
<span class="sd">        Nombre del objeto en contexto: &quot;medios&quot;</span>

<span class="sd">    **Métodos**</span>
<span class="sd">    -----------</span>
<span class="sd">    get_queryset() -&gt; QuerySet</span>
<span class="sd">        Retorna solo los medios del cliente actual, usando `select_related(&quot;tipo&quot;)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MedioAcreditacionCliente</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/clientes_list.html&quot;</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s2">&quot;medios&quot;</span>

<div class="viewcode-block" id="MedioClienteListView.get_queryset">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteListView.get_queryset">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cliente</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cliente</span><span class="p">)</span>
                <span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">))</span></div>
</div>


<div class="viewcode-block" id="MedioClienteCreateView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteCreateView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MedioClienteCreateView</span><span class="p">(</span><span class="n">RequireClienteMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vista para que un cliente cree un nuevo medio de acreditación.</span>

<span class="sd">    **Atributos**</span>
<span class="sd">    -------------</span>
<span class="sd">    model : Modelo</span>
<span class="sd">        :class:`MedioAcreditacionCliente`</span>
<span class="sd">    form_class : Formulario</span>
<span class="sd">        :class:`MedioAcreditacionClienteForm`</span>
<span class="sd">    template_name : str</span>
<span class="sd">        Template: &quot;medios_acreditacion/clientes_form.html&quot;</span>
<span class="sd">    success_url : str</span>
<span class="sd">        URL de redirección tras guardado exitoso.</span>

<span class="sd">    **Métodos**</span>
<span class="sd">    -----------</span>
<span class="sd">    get_initial() -&gt; dict</span>
<span class="sd">        Si se pasa un parámetro GET `tipo`, lo preasigna en los valores iniciales del formulario.</span>

<span class="sd">    form_valid(form) -&gt; HttpResponseRedirect</span>
<span class="sd">        Asigna `cliente` al formulario antes de guardar.</span>

<span class="sd">    get_form_kwargs() -&gt; dict</span>
<span class="sd">        Agrega `user` al contexto del formulario para validaciones internas.</span>
<span class="sd">        Si hay parámetro GET `tipo`, preasigna ese tipo si existe.</span>

<span class="sd">    get_context_data(**kwargs) -&gt; dict</span>
<span class="sd">        Agrega `&quot;accion&quot;: &quot;crear&quot;` al contexto.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">MedioAcreditacionCliente</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">MedioAcreditacionClienteForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/clientes_form.html&quot;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">&quot;medios_acreditacion:clientes_list&quot;</span><span class="p">)</span>



<div class="viewcode-block" id="MedioClienteCreateView.get_initial">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteCreateView.get_initial">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">initial</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_initial</span><span class="p">()</span>
        <span class="n">tipo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tipo</span><span class="p">:</span>
            <span class="n">initial</span><span class="p">[</span><span class="s2">&quot;tipo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tipo</span>
        <span class="k">return</span> <span class="n">initial</span></div>


<div class="viewcode-block" id="MedioClienteCreateView.form_valid">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteCreateView.form_valid">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">cliente</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cliente</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="MedioClienteCreateView.get_form_kwargs">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteCreateView.get_form_kwargs">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>   <span class="c1"># ahora el form lo acepta</span>
        <span class="c1"># Para que al cambiar el select muestre campos dinámicos</span>
        <span class="n">tipo_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tipo_id</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;initial&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">][</span><span class="s2">&quot;tipo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TipoMedioAcreditacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">tipo_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TipoMedioAcreditacion</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">kwargs</span></div>


<div class="viewcode-block" id="MedioClienteCreateView.get_context_data">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteCreateView.get_context_data">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;accion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;crear&quot;</span>
        <span class="k">return</span> <span class="n">ctx</span></div>
</div>



<div class="viewcode-block" id="MedioClienteUpdateView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteUpdateView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MedioClienteUpdateView</span><span class="p">(</span><span class="n">RequireClienteMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vista para que un cliente edite un medio de acreditación suyo.</span>

<span class="sd">    **Atributos**</span>
<span class="sd">    -------------</span>
<span class="sd">    model : Modelo</span>
<span class="sd">        :class:`MedioAcreditacionCliente`</span>
<span class="sd">    form_class : Formulario</span>
<span class="sd">        :class:`MedioAcreditacionClienteForm`</span>
<span class="sd">    template_name : str</span>
<span class="sd">        Template: &quot;medios_acreditacion/clientes_form.html&quot;</span>
<span class="sd">    success_url : str</span>
<span class="sd">        URL de redirección tras edición.</span>

<span class="sd">    **Métodos**</span>
<span class="sd">    -----------</span>
<span class="sd">    get_queryset() -&gt; QuerySet</span>
<span class="sd">        Restringe para que el cliente solo pueda editar sus propios medios.</span>

<span class="sd">    get_form_kwargs() -&gt; dict</span>
<span class="sd">        Agrega `user` al contexto del formulario.</span>

<span class="sd">    get_context_data(**kwargs) -&gt; dict</span>
<span class="sd">        Agrega `&quot;accion&quot;: &quot;editar&quot;` al contexto.</span>

<span class="sd">    form_valid(form) -&gt; HttpResponseRedirect</span>
<span class="sd">        Asegura que `cliente` esté asignado antes de guardar, y añade mensaje de éxito.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MedioAcreditacionCliente</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">MedioAcreditacionClienteForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/clientes_form.html&quot;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">&quot;medios_acreditacion:clientes_list&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MedioClienteUpdateView.get_queryset">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteUpdateView.get_queryset">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cliente</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cliente</span><span class="p">)</span></div>


<div class="viewcode-block" id="MedioClienteUpdateView.get_form_kwargs">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteUpdateView.get_form_kwargs">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="n">kwargs</span></div>


<div class="viewcode-block" id="MedioClienteUpdateView.get_context_data">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteUpdateView.get_context_data">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;accion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;editar&quot;</span>
        <span class="k">return</span> <span class="n">ctx</span></div>


<div class="viewcode-block" id="MedioClienteUpdateView.form_valid">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteUpdateView.form_valid">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">cliente</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cliente</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;Medio de acreditación actualizado correctamente ✏️&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="MedioClienteDeleteView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteDeleteView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MedioClienteDeleteView</span><span class="p">(</span><span class="n">RequireClienteMixin</span><span class="p">,</span> <span class="n">DeleteView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vista para que un cliente elimine uno de sus medios de acreditación.</span>

<span class="sd">    **Atributos**</span>
<span class="sd">    -------------</span>
<span class="sd">    model : Modelo</span>
<span class="sd">        :class:`MedioAcreditacionCliente`</span>
<span class="sd">    template_name : str</span>
<span class="sd">        Template: &quot;medios_acreditacion/clientes_confirm_delete.html&quot;</span>
<span class="sd">    success_url : str</span>
<span class="sd">        URL de redirección tras eliminar.</span>

<span class="sd">    **Métodos**</span>
<span class="sd">    -----------</span>
<span class="sd">    get_queryset() -&gt; QuerySet</span>
<span class="sd">        Restringe el queryset al cliente logueado.</span>

<span class="sd">    delete(request, *args, **kwargs) -&gt; HttpResponseRedirect</span>
<span class="sd">        Muestra mensaje de éxito y delega al método base.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MedioAcreditacionCliente</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;medios_acreditacion/clientes_confirm_delete.html&quot;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">&quot;medios_acreditacion:clientes_list&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MedioClienteDeleteView.get_queryset">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteDeleteView.get_queryset">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cliente</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cliente</span><span class="p">)</span></div>


<div class="viewcode-block" id="MedioClienteDeleteView.delete">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClienteDeleteView.delete">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;Medio de acreditación eliminado correctamente ❌&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>

    


<div class="viewcode-block" id="MedioClientePredeterminarView">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClientePredeterminarView">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MedioClientePredeterminarView</span><span class="p">(</span><span class="n">RequireClienteMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vista para que un cliente marque como predeterminado uno de sus medios de acreditación.</span>

<span class="sd">    Esta vista responde solo a solicitudes POST; no permite GET.</span>

<span class="sd">    **Métodos**</span>
<span class="sd">    -----------</span>
<span class="sd">    post(request, pk) -&gt; HttpResponse or HttpResponseBadRequest</span>
<span class="sd">        - Busca el medio con pk y cliente correspondiente.</span>
<span class="sd">        - Verifica que esté activo; si no, retorna Bad Request (400).</span>
<span class="sd">        - Marca `predeterminado = True` en el objeto (el modelo debería encargarse</span>
<span class="sd">          de desmarcar otros si es necesario) y lo guarda.</span>
<span class="sd">        - Responde con estado 204 (sin contenido) dado que usualmente se usa vía JS/AJAX.</span>

<span class="sd">    get(request, pk) -&gt; HttpResponseForbidden</span>
<span class="sd">        No está permitido acceder por GET: devuelve 403.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MedioClientePredeterminarView.post">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClientePredeterminarView.post">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="c1"># obtener el medio del cliente logueado</span>
        <span class="n">medio</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span>
            <span class="n">MedioAcreditacionCliente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cliente</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cliente</span><span class="p">),</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">medio</span><span class="o">.</span><span class="n">activo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponseBadRequest</span><span class="p">(</span><span class="s2">&quot;Medio inactivo.&quot;</span><span class="p">)</span>
        <span class="c1"># marcar y desmarcar otros (lo hace su save())</span>
        <span class="n">medio</span><span class="o">.</span><span class="n">predeterminado</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">medio</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># status 204: sin contenido; tu JS hace reload de la página</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">204</span><span class="p">)</span></div>


<div class="viewcode-block" id="MedioClientePredeterminarView.get">
<a class="viewcode-back" href="../../medios_acreditacion.html#medios_acreditacion.views.MedioClientePredeterminarView.get">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="c1"># no permitimos GET para esta acción</span>
        <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2025, Diego.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>