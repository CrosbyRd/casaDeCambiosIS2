{% extends "base.html" %}
{% block title %}Reporte de Transacciones{% endblock %}

{% block content %}
<main class="max-w-7xl mx-auto p-8">
 <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
  <div class="text-center sm:text-left">
    <h1 class="text-4xl font-extrabold mb-2" style="color:var(--ink)">ðŸ“„ Reporte de Transacciones</h1>
    <p class="text-lg leading-relaxed max-w-xl mx-auto sm:mx-0" style="color:var(--muted)">
      Visualiza y filtra el historial de transacciones realizadas en el sistema para analizar el pulso financiero de tus operaciones.
    </p>
  </div>

  <div class="flex justify-center sm:justify-end mt-4 sm:mt-0 gap-3">
    <a href="{% url 'reportes:panel_reportes' %}"
       class="px-4 py-2 rounded-xl font-bold bg-[var(--brand-soft)] hover:brightness-95 transition"
       style="color:var(--brand-dark)">
       â¬… Volver al Panel de Reportes
    </a>
  </div>
</header>


  <!-- ðŸŒ FILTROS con diseÃ±o -->
<section class="bg-white shadow rounded-lg p-4 mb-6 border border-blue-100">
  <h2 class="text-lg font-semibold text-gray-700 mb-2 flex items-center">
    Filtrar flujo de transacciones
  </h2>
  <p class="text-sm text-gray-500 mb-4">
    Ajusta los filtros para visualizar el pulso financiero de tus operaciones.
  </p>
  <form method="get" class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
    <div>
      <label class="block text-sm font-medium text-gray-700">Fecha inicio</label>
      <input type="date" name="fecha_inicio" value="{{ request.GET.fecha_inicio }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Fecha fin</label>
      <input type="date" name="fecha_fin" value="{{ request.GET.fecha_fin }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Estado</label>
      <select name="estado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" onchange="this.form.submit()">
        <option value="">-- Todos --</option>
        {% for code, name in estados %}
          <option value="{{ code }}" {% if request.GET.estado == code %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Tipo de operaciÃ³n</label>
      <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" onchange="this.form.submit()">
        <option value="">-- Todos --</option>
        {% for value, name in tipos_operacion %}
          <option value="{{ value }}" {% if request.GET.tipo == value %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Cliente</label>
      <input type="text" name="cliente" value="{{ request.GET.cliente }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" placeholder="Nombre cliente">
    </div>

      <div>
          <label class="block text-sm font-medium text-gray-700">Moneda</label>
          <select name="moneda" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" onchange="this.form.submit()">
            <option value="">-- Todas --</option>
            {% for m in monedas %}
              {% if m.codigo != "PYG" %}
                <option value="{{ m.codigo }}" {% if request.GET.moneda == m.codigo %}selected{% endif %}>
                  {{ m.nombre }} ({{ m.codigo }})
                </option>
              {% endif %}
            {% endfor %}
          </select>
      </div>


    <!-- Botones filtrar / limpiar -->
    <div class="flex space-x-2 mt-2 md:mt-0">
      <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
        Filtrar
      </button>
      <a href="{% url 'reportes:reporte_transacciones' %}" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">
        Limpiar
      </a>
    </div>
  </form>
</section>


  <!-- Botones PDF/Excel -->
 <div class="flex justify-end items-center mb-4 space-x-2">
    <a href="{% url 'reportes:reporte_transacciones_pdf' %}?{{ request.GET.urlencode }}" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">ðŸ“„ Descargar PDF</a>
    <a href="{% url 'reportes:reporte_transacciones_excel' %}?{{ request.GET.urlencode }}" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">ðŸ“Š Exportar Excel</a>
  </div>

  <!-- Tabla de transacciones -->

<div class="overflow-x-auto bg-white shadow rounded-lg border border-gray-100 min-h-[300px]">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-blue-50">
      <tr>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase">#</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase">Cliente</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase">Tipo</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase">Moneda</th>
        <th class="px-4 py-2 text-right text-xs font-medium text-gray-700 uppercase">Monto Origen</th>
        <th class="px-4 py-2 text-right text-xs font-medium text-gray-700 uppercase">Monto Destino</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase">Estado</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase">Fecha</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      {% for t in page_obj %}
      <tr class="hover:bg-blue-50 transition {% cycle 'bg-white' 'bg-gray-50' %}">
        <td class="px-4 py-2">{{ forloop.counter0|add:page_obj.start_index }}</td>
        <td class="px-4 py-2 font-medium text-gray-800">{{ t.cliente }}</td>
        <td class="px-4 py-2">
          {% if t.tipo_operacion == 'venta' %}
            <span class="text-green-700 font-semibold">Venta de Divisa </span>
          {% else %}
            <span class="text-red-700 font-semibold">Compra de Divisa </span>
          {% endif %}
        </td>
        <td class="px-4 py-2">
          {% if t.tipo_operacion == 'compra' %}
            {{ t.moneda_origen.codigo }}
          {% else %}
            {{ t.moneda_destino.codigo }}
          {% endif %}
        </td>
        <td class="px-4 py-2 text-right">{{ t.monto_origen|floatformat:2 }}</td>
        <td class="px-4 py-2 text-right">{{ t.monto_destino|floatformat:2 }}</td>
        <td class="px-4 py-2">{{ t.get_estado_display_dinamico }}</td>
        <td class="px-4 py-2">{{ t.fecha_creacion|date:"d/m/Y H:i" }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8" class="px-4 py-4 text-center text-gray-500">
          ðŸ’¤ No se registran flujos financieros en este perÃ­odo.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


    <!-- PAGINACIÃ“N -->
    <div class="flex justify-center mt-4 gap-2 text-sm">
      {% if page_obj.has_previous %}
        <a href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k }}={{ v }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition">â¬… Anterior</a>
      {% endif %}

      <span class="px-3 py-1">PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k }}={{ v }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition">Siguiente âž¡</a>
      {% endif %}
    </div>
  </div>
</main>
{% endblock %}
