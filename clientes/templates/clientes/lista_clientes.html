{% extends "base.html" %}
{% block title %}Gesti√≥n de Clientes ‚Äî Global Exchange{% endblock %}

{% block content %}
<main class="max-w-6xl mx-auto px-6 py-10">

  <!-- Mensajes -->
  {% if messages %}
  <div class="mb-6">
    {% for message in messages %}
      <div class="bg-green-500 text-white px-4 py-2 rounded-lg mb-2">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Encabezado -->
  <header class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-4xl font-extrabold mb-2" style="color:var(--ink)">üë§ Clientes</h1>
      <p class="text-lg leading-relaxed max-w-xl" style="color:var(--muted)">
        Aqu√≠ puedes gestionar los clientes del sistema: crear, editar, activar/desactivar o eliminar.
      </p>
    </div>
    <div class="space-x-3 flex">
      <a href="{% url 'admin_panel:dashboard' %}" 
         class="px-4 py-2 rounded-lg font-bold bg-[var(--brand-soft)] hover:brightness-95"
         style="color:var(--brand-dark)">
        ‚¨Ö Volver al Panel
      </a>
      <a href="{% url 'clientes:crear' %}" 
         class="px-4 py-2 rounded-lg font-bold text-white"
         style="background:var(--brand)">
        ‚ûï Crear Cliente
      </a>
    </div>
  </header>

  <!-- Filtros -->
  <section class="bg-white border rounded-xl shadow-sm p-6 mb-6" style="border-color:var(--line)">
    <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div>
        <input type="text" name="q" placeholder="Buscar por nombre o email..." 
               value="{{ search_query }}"
               class="w-full border border-gray-300 rounded-lg px-4 py-2">
      </div>
      <div>
        <select name="categoria" class="w-full border border-gray-300 rounded-lg px-4 py-2">
          <option value="">Todas las categor√≠as</option>
          <option value="minorista" {% if categoria_filtro == 'minorista' %}selected{% endif %}>Minorista</option>
          <option value="corporativo" {% if categoria_filtro == 'corporativo' %}selected{% endif %}>Corporativo</option>
          <option value="vip" {% if categoria_filtro == 'vip' %}selected{% endif %}>VIP</option>
        </select>
      </div>
      <div>
        <select name="activo" class="w-full border border-gray-300 rounded-lg px-4 py-2">
          <option value="">Todos</option>
          <option value="true" {% if activo_filtro == 'true' %}selected{% endif %}>Activos</option>
          <option value="false" {% if activo_filtro == 'false' %}selected{% endif %}>Inactivos</option>
        </select>
      </div>
      <div>
        <button type="submit" class="w-full px-4 py-2 rounded-lg font-bold text-white" style="background:var(--brand)">
          Buscar
        </button>
      </div>
    </form>
  </section>

  <!-- Tabla -->
  <section class="bg-white border rounded-xl shadow-sm overflow-hidden" style="border-color:var(--line)">
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead style="background:var(--brand); color:#fff">
          <tr>
            <th class="px-6 py-3">Nombre</th>
            <th class="px-6 py-3">Categor√≠a</th>
            <th class="px-6 py-3">Bonificaci√≥n</th>
            <th class="px-6 py-3">L√≠mite USD</th>
            <th class="px-6 py-3">Estado</th>
            <th class="px-6 py-3 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for cliente in clientes %}
          <tr class="border-b hover:bg-[var(--brand-soft)]" style="border-color:var(--line)">
            <td class="px-6 py-4 font-semibold text-[var(--ink)]">{{ cliente.nombre }}</td>

            <td class="px-6 py-4">
              <span class="px-2 py-1 rounded text-sm font-medium bg-[var(--brand-soft)] text-[var(--brand-dark)]">
                {{ cliente.get_categoria_display }}
              </span>
            </td>
            <td class="px-6 py-4 text-green-600 font-bold">{{ cliente.bonificacion }}%</td>
            <td class="px-6 py-4">${{ cliente.limite_compra_usd|floatformat:2 }}</td>
            <td class="px-6 py-4">
              {% if cliente.activo %}
                <span class="text-green-600 font-semibold">Activo</span>
              {% else %}
                <span class="text-red-600 font-semibold">Inactivo</span>
              {% endif %}
            </td>
            <td class="px-6 py-4 text-center space-x-2">
              <a href="{% url 'clientes:detalle' cliente.id_cliente %}" 
                 class="px-3 py-1 rounded-md font-semibold text-[var(--brand-dark)] bg-[var(--brand-soft)] hover:brightness-95">
                Ver
              </a>
              <a href="{% url 'clientes:editar' cliente.id_cliente %}" 
                 class="px-3 py-1 rounded-md font-semibold text-[var(--brand-dark)] bg-[var(--brand-soft)] hover:brightness-95">
                Editar
              </a>
              <a href="{% url 'clientes:toggle_estado' cliente.id_cliente %}" 
                 class="px-3 py-1 rounded-md font-semibold text-white {% if cliente.activo %}bg-yellow-500 hover:bg-yellow-600{% else %}bg-green-600 hover:bg-green-700{% endif %}">
                {% if cliente.activo %}Desactivar{% else %}Activar{% endif %}
              </a>
              <a href="{% url 'clientes:eliminar' cliente.id_cliente %}" 
                 class="px-3 py-1 rounded-md font-semibold text-white bg-red-600 hover:bg-red-700">
                Eliminar
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="px-6 py-6 text-center text-neutral-400">
              No se encontraron clientes.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</main>
{% endblock %}
