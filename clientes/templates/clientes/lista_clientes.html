{% extends 'clientes/base.html' %}

{% block content %}
<!-- Botón para volver al panel de administrador -->
<div class="mb-3">
  <a href="{% url 'admin_panel:dashboard' %}" class="btn btn-secondary">
    ← Volver al Panel de Administrador
  </a>
</div>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 m-0"><i class="fas fa-users"></i> Lista de Clientes</h1>
  <a href="{% url 'clientes:crear' %}" class="btn btn-success">
    <i class="fas fa-plus"></i> Nuevo Cliente
  </a>
</div>

<!-- Formulario de Búsqueda -->
<div class="card mb-4">
  <div class="card-body">
    <form method="get" class="row g-3">
      <div class="col-12 col-md-4">
        <input type="text" name="q" class="form-control" placeholder="Buscar por nombre o email..." value="{{ search_query }}">
      </div>
      <div class="col-6 col-md-3">
        <select name="categoria" class="form-select">
          <option value="">Todas las categorías</option>
          <option value="minorista" {% if categoria_filtro == 'minorista' %}selected{% endif %}>Minorista</option>
          <option value="corporativo" {% if categoria_filtro == 'corporativo' %}selected{% endif %}>Corporativo</option>
          <option value="vip" {% if categoria_filtro == 'vip' %}selected{% endif %}>VIP</option>
        </select>
      </div>
      <div class="col-6 col-md-3">
        <select name="activo" class="form-select">
          <option value="">Todos</option>
          <option value="true" {% if activo_filtro == 'true' %}selected{% endif %}>Activos</option>
          <option value="false" {% if activo_filtro == 'false' %}selected{% endif %}>Inactivos</option>
        </select>
      </div>
      <div class="col-12 col-md-2">
        <button type="submit" class="btn btn-primary w-100">
          <i class="fas fa-search"></i> Buscar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Tabla de Clientes -->
<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Categoría</th>
            <th>Bonificación</th>
            <th>Límite USD</th>
            <th>Estado</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for cliente in clientes %}
          <tr>
            <td>{{ cliente.nombre }}</td>
            <td>{{ cliente.correo_electronico }}</td>
            <td><span class="badge bg-info">{{ cliente.get_categoria_display }}</span></td>
            <td><span class="badge bg-success">{{ cliente.bonificacion }}%</span></td>
            <td>${{ cliente.limite_compra_usd|floatformat:2 }}</td>
            <td>
              <span class="badge {% if cliente.activo %}bg-success{% else %}bg-danger{% endif %}">
                {% if cliente.activo %}Activo{% else %}Inactivo{% endif %}
              </span>
            </td>
            <td>
              <div class="d-flex justify-content-end flex-wrap gap-2">
                <a href="{% url 'clientes:detalle' cliente.id_cliente %}" class="btn btn-sm btn-info" title="Ver detalles">
                  <i class="fas fa-eye"></i>
                </a>
                <a href="{% url 'clientes:editar' cliente.id_cliente %}" class="btn btn-sm btn-warning" title="Editar">
                  <i class="fas fa-edit"></i>
                </a>
                <a href="{% url 'clientes:toggle_estado' cliente.id_cliente %}" class="btn btn-sm {% if cliente.activo %}btn-warning{% else %}btn-success{% endif %}" title="{% if cliente.activo %}Desactivar{% else %}Activar{% endif %}">
                  <i class="fas {% if cliente.activo %}fa-times{% else %}fa-check{% endif %}"></i>
                </a>
                <a href="{% url 'clientes:eliminar' cliente.id_cliente %}" class="btn btn-sm btn-danger" title="Eliminar">
                  <i class="fas fa-trash"></i>
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-4">
              <i class="fas fa-users fa-2x mb-2"></i><br>No se encontraron clientes
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
