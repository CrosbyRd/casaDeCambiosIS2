{% extends "base.html" %}
{% block title %}TED | Operar{% endblock %}

{% block content %}
<main class="max-w-[1200px] mx-auto px-6 py-8">
  <h1 class="h1 mb-2">Operar en TED</h1>
  <p class="muted mb-6">{{ operacion_label }}</p>

  <!-- Resumen moneda / tasa -->
  <section class="box mb-6">
    <div class="grid sm:grid-cols-3 gap-4">
      <div>
        <h3 class="h2 mb-1">Moneda</h3>
        <div class="font-extrabold">{{ moneda.codigo }}</div>
        <div class="muted">{{ moneda.nombre }}</div>
      </div>
      <div>
        <h3 class="h2 mb-1">Tasa aplicada</h3>
        {% if tasa %}
          <div class="font-extrabold">{{ tasa }}</div>
          <div class="muted">Vigencia 15 min desde su aplicación</div>
        {% else %}
          <div class="muted">Sin cotización vigente</div>
        {% endif %}
      </div>
      <div>
        <h3 class="h2 mb-1">Tipo de operación</h3>
        <div class="font-extrabold">
          {% if operacion == 'COMPRA' %}Compra (retiro billetes){% else %}Venta (depósito billetes){% endif %}
        </div>
        <div class="muted">Base PYG</div>
      </div>
    </div>
  </section>

  <!-- Denominaciones -->
  <section class="box mb-6">
    <h2 class="h2 mb-2">Denominaciones</h2>
    <p class="muted mb-4">Indique la cantidad de billetes por denominación.</p>

    {% if denominaciones %}
      <form action="" method="post" class="form form--compact">
        {% csrf_token %}
        <input type="hidden" name="moneda" value="{{ moneda.id }}">
        <input type="hidden" name="operacion" value="{{ operacion }}">
        <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-4">
          {% for d in denominaciones %}
            <div class="box box--tight">
              <label class="block font-bold mb-1">{{ moneda.codigo }} {{ d.valor }}</label>
              <input type="number" min="0" name="denom_{{ d.id }}" value="0">
            </div>
          {% endfor %}
        </div>

        <div class="actions">
          <a href="{% url 'admin_panel:ted:panel' %}" class="btn-secondary">Volver</a>
          <button class="btn" type="submit">Confirmar operación</button>
        </div>
      </form>
    {% else %}
      <div class="muted">No hay denominaciones activas para {{ moneda.codigo }}.</div>
      <div class="actions mt-4">
        <a href="{% url 'admin_panel:ted:panel' %}" class="btn-secondary">Volver</a>
      </div>
    {% endif %}
  </section>

  <!-- Ayuda -->
  <section class="box">
    <h2 class="h2 mb-2">Ayuda</h2>
    <p class="mb-1"><strong>COMPRA</strong>: se aplica la <em>tasa de venta</em>.</p>
    <p class="mb-1"><strong>VENTA</strong>: se aplica la <em>tasa de compra</em>.</p>
    <p class="muted">El ticket se muestra al finalizar y puedes imprimirlo.</p>
  </section>
</main>
{% endblock %}
