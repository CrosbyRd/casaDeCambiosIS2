{% extends "base.html" %}
{% block title %}Global Exchange{% endblock %}

{% block content %}
<main class="max-w-5xl mx-auto px-6 py-10">
  <!-- Encabezado -->
  <header class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-4xl font-extrabold mb-2 text-[var(--ink)]">Crear stock</h1>
      <p class="text-lg leading-relaxed max-w-2xl text-[var(--muted)]">
        Complete el formulario para registrar denominaciones y stock inicial en la terminal.
        Nº de serie: <strong>{{ serial }}</strong> · Ubicación: <strong>{{ direccion }}</strong>
      </p>
    </div>

    <a href="{% url 'admin_panel:ted:inventario' %}"
       class="px-4 py-2 rounded-lg font-bold bg-[var(--brand-soft)] hover:brightness-95"
       style="color:var(--brand-dark)">⬅ Volver</a>
  </header>

  <!-- Formulario -->
  <section class="bg-white border rounded-xl shadow-sm mb-4" style="border-color:var(--line)">
    <form method="post" id="stock-form" class="pb-6">
      {% csrf_token %}

      <!-- Moneda -->
      <div class="overflow-x-auto">
        <div class="w-full min-w-[560px] rounded-xl overflow-hidden border" style="border-color:var(--line)">
          <table class="w-full border-collapse">
            <thead class="bg-[var(--brand)] text-white">
              <tr><th class="px-4 py-3 text-left">Moneda</th></tr>
            </thead>
            <tbody>
              <tr class="hover:bg-[var(--brand-soft)] bg-white">
                <td class="px-4 py-3">
                  <select id="id_moneda" name="moneda" class="w-full max-w-[380px]">
                    <option value="">— Seleccione —</option>
                    {% for m in monedas %}
                      <option value="{{ m.id }}">{{ m.codigo }} — {{ m.nombre }}</option>
                    {% endfor %}
                  </select>
                  <p class="text-sm mt-2 text-[var(--muted)]">
                    Al guardar, la moneda quedará habilitada para operar en la terminal.
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Denominaciones / Stock -->
      <div class="overflow-x-auto mt-6">
        <table class="w-full border-collapse min-w-[560px]">
          <colgroup>
            <col style="width:55%">
            <col style="width:35%">
            <col style="width:10%">
          </colgroup>
          <thead class="bg-[var(--brand)] text-white">
            <tr>
              <th class="px-4 py-3 text-left">Denominación (valor)</th>
              <th class="px-4 py-3 text-left">Stock</th>
              <th class="px-4 py-3 text-center">Acción</th>
            </tr>
          </thead>
          <tbody id="tbody-denoms">
            <!-- filas dinámicas -->
          </tbody>
        </table>
      </div>
    </form>
  </section>

  <!-- Botones -->
  <div class="flex justify-between items-center">
    <button type="button"
            class="px-4 py-2 rounded-lg font-semibold bg-white border hover:bg-gray-50"
            style="border-color:var(--line); color:var(--ink)"
            onclick="addRow()">
      + Agregar fila
    </button>

    <div class="flex gap-3">
      <a href="{% url 'admin_panel:ted:inventario' %}"
         class="px-4 py-2 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700">
        Cancelar
      </a>
      <button type="submit" form="stock-form"
              class="px-6 py-2 rounded-lg font-bold text-white shadow-sm"
              style="background:var(--brand)">
        Guardar
      </button>
    </div>
  </div>
</main>

<style>
  /* Inputs con el mismo look que “Crear Moneda” */
  #id_moneda,
  .den-input,
  .stk-input{
    width:100%;
    max-width:380px;
    background:#fff;
    border:1.5px solid var(--line);
    border-radius:12px;
    padding:12px 14px;
    height:48px;
    font-size:1rem;
    color:var(--ink);
    box-shadow:0 1px 2px rgba(0,0,0,.03);
    transition:box-shadow .2s,border-color .2s;
  }
  #id_moneda:focus,
  .den-input:focus,
  .stk-input:focus{
    outline:none;border-color:var(--brand);
    box-shadow:0 0 0 3px rgba(115,60,255,.15);
  }
  .remove-btn{
    display:inline-flex;align-items:center;justify-content:center;
    padding:10px 12px;border-radius:10px;
    background:#ef4444;color:#fff;font-weight:600;
  }
  .remove-btn:hover{ filter:brightness(.95); }
</style>

<script>
  function trTemplate(){
    return `
      <tr class="hover:bg-[var(--brand-soft)]">
        <td class="px-4 py-3 align-middle">
          <input type="number" step="0.01" min="0.01" name="den_valor[]" placeholder="Ej: 100.00" class="den-input" required>
        </td>
        <td class="px-4 py-3 align-middle">
          <input type="number" step="1" min="0" name="den_stock[]" placeholder="0" class="stk-input" required>
        </td>
        <td class="px-4 py-3 align-middle text-center">
          <button type="button" class="remove-btn" onclick="removeRow(this)">✖</button>
        </td>
      </tr>`;
  }
  function addRow(){
    const tbody = document.getElementById('tbody-denoms');
    const wrapper = document.createElement('tbody'); // temporal para parsear
    wrapper.innerHTML = trTemplate();
    tbody.appendChild(wrapper.firstElementChild);
  }
  function removeRow(btn){
    const tr = btn.closest('tr');
    if(tr) tr.remove();
  }
  // 3 filas iniciales
  addRow(); addRow(); addRow();
</script>
{% endblock %}