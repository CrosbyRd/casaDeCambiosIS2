{% extends "base.html" %}
{% load static %}
{% block title %}Seleccionar cliente - Global Exchange{% endblock %}

{% block content %}
<main class="max-w-[1040px] mx-auto px-6 py-8 space-y-6">

  <!-- Encabezado de página -->
  <header class="space-y-1">
    <h1 class="text-4xl md:text-5xl font-extrabold text-[var(--ink)]">Seleccionar cliente</h1>
    <p class="text-[var(--muted)]">Elegí con qué cliente querés operar. Podés cambiarlo en cualquier momento.</p>
  </header>

  <!-- Grid principal -->
  <section class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Columna izquierda: tarjeta de selección -->
    <form method="post" class="rounded-2xl overflow-hidden border shadow-sm" style="border-color:var(--line)">
      {% csrf_token %}

      <!-- Barra de título lila -->
      <div class="px-4 py-3 font-extrabold text-white" style="background:var(--brand);">
        Cliente
      </div>

      <!-- Cuerpo -->
      <div class="p-5 space-y-4 bg-white">
        {% with activo_id=request.session.cliente_activo_id %}
          <label for="cliente_id" class="block text-sm font-semibold mb-1">Elegí un cliente</label>
          <select id="cliente_id" name="cliente_id" class="gx-field" aria-describedby="clienteHelp" required>
            {% for c in clientes %}
              <option value="{{ c.pk }}"
                {% if activo_id %}
                  {% if c.pk|stringformat:"s" == activo_id|stringformat:"s" %}selected{% endif %}
                {% else %}
                  {% if forloop.first %}selected{% endif %}
                {% endif %}
              >{{ c }}</option>
            {% endfor %}
          </select>
        {% endwith %}

        <p id="clienteHelp" class="mt-1 text-xs text-[var(--muted)]">
          El cliente activo se usará en tus operaciones y en el historial.
        </p>

        <div class="flex items-center gap-3 pt-2">
          <button type="submit" class="gx-btn">Usar este cliente</button>
          <a href="{% url 'usuarios:dashboard' %}" class="gx-btn gx-btn--ghost">Cancelar</a>
        </div>
      </div>
    </form>

    <!-- Columna derecha: tarjeta de previsualización -->
    <aside class="rounded-2xl overflow-hidden border shadow-sm" style="border-color:var(--line)">
      <!-- Barra de título lila -->
      <div class="px-4 py-3 font-extrabold text-white" style="background:var(--brand);">
        Previsualización
      </div>

      <!-- Cuerpo -->
      <div class="p-6 bg-white">
        <div class="flex items-start gap-4">
          <!-- Avatar por defecto (no modificable) -->
          <div class="h-20 w-20 rounded-full overflow-hidden flex items-center justify-center shadow-sm"
               aria-hidden="true"
               style="background: radial-gradient(120% 120% at 30% 30%, #ffffff 0%, #e9e2ff 55%, #cbb9ff 100%); border:1.5px solid var(--brand-soft)">
            <svg viewBox="0 0 128 128" width="72" height="72" role="img" aria-label="Avatar">
              <circle cx="64" cy="64" r="64" fill="transparent"/>
              <g fill="#2b2f36">
                <circle cx="64" cy="50" r="22"/>
                <path d="M18,112c6-22,26-34,46-34s40,12,46,34" fill="#2b2f36"/>
              </g>
            </svg>
          </div>

          <div class="min-w-0">
            <div class="text-xs font-semibold text-[var(--muted)]">Cliente seleccionado</div>
            <div id="cliente_nombre_preview"
                 class="mt-1 inline-flex items-center gap-2 px-3 py-1 rounded-full font-extrabold"
                 style="border:1.5px solid var(--brand-soft); background:var(--brand-soft); color:var(--brand-dark);">
              <!-- Se completa por JS con el texto del option seleccionado -->
            </div>
            <p class="mt-3 text-sm text-[var(--muted)]">
              Esta selección se reflejará en tu panel y en las próximas operaciones.
            </p>
          </div>
        </div>
      </div>
    </aside>

  </section>
</main>

<!-- Utilitarios visuales coherentes con el proyecto -->
<style>
  .gx-field{
    width:100%; border:1.5px solid var(--line); border-radius:12px; padding:10px 12px; height:44px;
    background:#fff; color:var(--ink); transition:box-shadow .15s, border-color .15s;
  }
  .gx-field:focus{ outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(124,58,237,.18); }

  .gx-btn{
    background:var(--brand); color:#fff; font-weight:800; border:none; border-radius:12px; padding:10px 14px;
    box-shadow:0 8px 24px color-mix(in oklab, var(--brand) 30%, transparent);
  }
  .gx-btn--ghost{
    background:#fff; color:var(--ink); border:1.5px solid var(--line); box-shadow:none;
  }
  .gx-btn--ghost:hover{ background:var(--brand-soft); }
</style>

<!-- Previsualización reactiva del nombre (sin tocar backend) -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var sel = document.getElementById('cliente_id');
    var out = document.getElementById('cliente_nombre_preview');
    if (!sel || !out) return;
    function update() {
      var t = sel.options[sel.selectedIndex] ? sel.options[sel.selectedIndex].text : '';
      out.textContent = t || 'Ninguno';
    }
    update();
    sel.addEventListener('change', update);
  });
</script>
{% endblock %}
