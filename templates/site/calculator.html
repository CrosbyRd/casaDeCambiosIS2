{% extends "base.html" %}

{% block content %}

{% include "partials/page_header.html" with title="Calculadora" subtitle="SimulÃ¡ tu conversiÃ³n al instante" back_url="/" %}
{% include "partials/messages.html" %}

<main class="max-w-5xl mx-auto px-6 py-10">

  <section class="bg-white border rounded-xl shadow-sm mb-4" style="border-color:var(--line)">
    <form method="post" id="form-simulador"
          data-currencies='{
            "USD":{"name":"DÃ³lar estadounidense","symbol":"$","emoji":"ðŸ‡ºðŸ‡¸"},
            "EUR":{"name":"Euro","symbol":"â‚¬","emoji":"ðŸ‡ªðŸ‡º"},
            "ARS":{"name":"Peso argentino","symbol":"$","emoji":"ðŸ‡¦ðŸ‡·"},
            "BRL":{"name":"Real brasileÃ±o","symbol":"R$","emoji":"ðŸ‡§ðŸ‡·"},
            "CLP":{"name":"Peso chileno","symbol":"$","emoji":"ðŸ‡¨ðŸ‡±"},
            "COP":{"name":"Peso colombiano","symbol":"$","emoji":"ðŸ‡¨ðŸ‡´"},
            "MXN":{"name":"Peso mexicano","symbol":"$","emoji":"ðŸ‡²ðŸ‡½"},
            "PEN":{"name":"Sol peruano","symbol":"S/","emoji":"ðŸ‡µðŸ‡ª"},
            "PYG":{"name":"GuaranÃ­ paraguayo","symbol":"â‚²","emoji":"ðŸ‡µðŸ‡¾"},
            "UYU":{"name":"Peso uruguayo","symbol":"$","emoji":"ðŸ‡ºðŸ‡¾"},
            "GBP":{"name":"Libra esterlina","symbol":"Â£","emoji":"ðŸ‡¬ðŸ‡§"},
            "JPY":{"name":"Yen japonÃ©s","symbol":"Â¥","emoji":"ðŸ‡¯ðŸ‡µ"},
            "CNY":{"name":"Yuan chino","symbol":"Â¥","emoji":"ðŸ‡¨ðŸ‡³"},
            "AUD":{"name":"DÃ³lar australiano","symbol":"$","emoji":"ðŸ‡¦ðŸ‡º"},
            "CAD":{"name":"DÃ³lar canadiense","symbol":"$","emoji":"ðŸ‡¨ðŸ‡¦"},
            "CHF":{"name":"Franco suizo","symbol":"Fr","emoji":"ðŸ‡¨ðŸ‡­"}
          }'>
      {% csrf_token %}

      <table class="w-full border-collapse">
        <thead class="bg-[var(--brand)] text-white">
          <tr>
            <th class="px-4 py-3 text-left">Tengo esta moneda</th>
            <th class="px-4 py-3 text-left">Quiero esta moneda</th>
          </tr>
        </thead>
        <tbody>
          <tr class="hover:bg-[var(--brand-soft)]">
            <td class="px-4 py-3">{{ form.moneda_origen }}</td>
            <td class="px-4 py-3">{{ form.moneda_destino }}</td>
          </tr>
          <tr class="hover:bg-[var(--brand-soft)]">
            <td class="px-4 py-3">{{ form.monto }}</td>
            <td class="px-4 py-3">
              <input class="gx-input" type="text" readonly
                     value="{% if resultado and not resultado.error %}{{ resultado.monto_recibido }}{% endif %}"
                     placeholder="0,00">
            </td>
          </tr>
        </tbody>
      </table>

      <div class="px-4 py-4">
<div style="margin-top:18px;">
  <button class="gx-btn" type="submit">Calcular</button>

            {% if resultado %}
                {% if resultado.error %}
                <div class="gx-error mt-4"><strong>Error:</strong> {{ resultado.error }}</div>
                {% else %}
                <div class="gx-result-wrap mt-4">
                    <div class="gx-result-big">
                    RecibirÃ¡s aproximadamente: {{ resultado.monto_recibido }} {{ form.moneda_destino.value }}
                    </div>

                </div>
                {% endif %}
            {% endif %}
            </div>

      </div>
    </form>
  </section>
</main>

<style>
  .gx-input, .gx-select {
    width:100%;
    border:1.5px solid var(--line);
    border-radius:12px;
    padding:12px 14px;
    height:48px;
    font-size:1rem;
    color:var(--ink);
    background:#fff;
    transition:box-shadow .2s ease,border-color .2s ease;
  }
  .gx-input:focus, .gx-select:focus {
    outline:none;
    border-color:var(--brand);
    box-shadow:0 0 0 3px rgba(115,60,255,.15);
  }
  .gx-btn {
    background: var(--brand);
    color:#fff;
    font-weight:800;
    border:none;
    border-radius:12px;
    padding:12px 16px;
    font-size:16px;
    width:100%;
    box-shadow:0 8px 24px color-mix(in oklab, var(--brand) 30%, transparent);
    cursor:pointer;
  }
  .gx-result-big { font-size:24px; font-weight:900; color:#22c55e; }
</style>

<script>
(function(){
  const form = document.getElementById('form-simulador');
  if(!form) return;

  const data = JSON.parse(form.dataset.currencies || "{}");

  function decorateSelect(sel){
    if(!sel) return;
    [...sel.options].forEach(opt=>{
      const code = opt.value;
      if(data[code]){
        const {emoji, name} = data[code];
        opt.textContent = `${emoji} ${code} â€” ${name}`;
      }
    });
    sel.classList.add('gx-select');
  }

  decorateSelect(document.getElementById('id_moneda_origen'));
  decorateSelect(document.getElementById('id_moneda_destino'));

  // ðŸ”¥ Forzar clase gx-input al campo de monto
  const monto = document.getElementById('id_monto');
  if(monto) monto.classList.add('gx-input');
})();

</script>

{% endblock %}
