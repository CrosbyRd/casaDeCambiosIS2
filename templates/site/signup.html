{% extends "base.html" %}
{% block title %}Crear cuenta — Global Exchange{% endblock %}

{% block content %}
<main id="main" class="max-w-[1200px] mx-auto px-6 py-8">
  <h1 class="h1 mb-6">Crear cuenta</h1>

  <div class="grid md:grid-cols-2 gap-6">
    <form id="signupForm" class="border border-neutral-200 rounded-lg p-6" method="post" novalidate>
      {% csrf_token %}

      <div class="mb-6">
        <label class="block mb-3 font-medium" for="id_email">Email</label>
        <input id="id_email" name="email" type="email"
               class="w-full h-11 px-4 border border-neutral-300 rounded-md focus-visible:ring-4 focus-visible:ring-brand"
               placeholder="tu@correo.com" autofocus />
      </div>

      <div class="mb-6">
        <label class="block mb-3 font-medium" for="id_password">Contraseña</label>
        <input id="id_password" name="password" type="password"
               class="w-full h-11 px-4 border border-neutral-300 rounded-md focus-visible:ring-4 focus-visible:ring-brand"
               placeholder="Ingresa tu contraseña" />
      </div>

      <div class="mb-6">
        <label class="inline-flex items-center gap-3">
          <input id="id_terms" type="checkbox" class="h-5 w-5" />
          <span>Acepto <a class="text-brand hover:underline" href="{% url 'site_legal' %}">términos y privacidad</a></span>
        </label>
      </div>

      <button class="btn w-full" type="submit">Registrarme</button>

      <a href="{% url 'site_login' %}" class="btn-secondary mt-6 w-full inline-flex justify-center">Ya tengo cuenta</a>
    </form>

    <aside class="border border-neutral-200 rounded-lg p-6">
      <h2 class="h2 mb-3">Verificación por email</h2>
      <p class="text-neutral-600">Te enviaremos un enlace para verificar tu dirección.</p>
    </aside>
  </div>

  <!-- Modal de error -->
  <div id="signupError" class="modal hidden">
    <div class="modal-overlay" data-modal-overlay tabindex="-1" aria-hidden="true"></div>
    <div class="w-full h-full flex items-center justify-center p-6">
      <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="signupErrTitle">
        <h2 id="signupErrTitle" class="h2 mb-4">Datos incompletos</h2>
        <p class="text-neutral-700 mb-6">Email, contraseña y aceptación de términos son obligatorios.</p>
        <div class="flex gap-3 justify-end">
          <button class="btn" data-modal-close="signupError">Entendido</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal OK (placeholder mientras no hay backend) -->
  <div id="signupOK" class="modal hidden">
    <div class="modal-overlay" data-modal-overlay tabindex="-1" aria-hidden="true"></div>
    <div class="w-full h-full flex items-center justify-center p-6">
      <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="signupOkTitle">
        <h2 id="signupOkTitle" class="h2 mb-4">Registro pendiente</h2>
        <p class="text-neutral-700 mb-6">Pronto habilitaremos el registro. Mientras tanto, puedes iniciar sesión si ya tienes cuenta.</p>
        <div class="flex gap-3 justify-end">
          <a class="btn-secondary" href="{% url 'site_login' %}">Ir a iniciar sesión</a>
          <button class="btn" data-modal-close="signupOK">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  const form = document.getElementById('signupForm');
  const modalErr = document.getElementById('signupError');
  const modalOK  = document.getElementById('signupOK');

  form.addEventListener('submit', function(e){
    e.preventDefault();
    const email = document.getElementById('id_email').value.trim();
    const pass  = document.getElementById('id_password').value.trim();
    const terms = document.getElementById('id_terms').checked;

    if (!email || !pass || !terms) {
      modalErr.classList.remove('hidden');
      return;
    }
    // Mientras no haya backend: mostramos confirmación de placeholder
    modalOK.classList.remove('hidden');
  });

  // Cierre de modales (mismo patrón que usamos en home)
  document.addEventListener('click', (e) => {
    const overlay = e.target?.closest('[data-modal-overlay]');
    const closeId = e.target?.closest('[data-modal-close]')?.getAttribute('data-modal-close');
    if (overlay) overlay.closest('.modal')?.classList.add('hidden');
    if (closeId) document.getElementById(closeId)?.classList.add('hidden');
  });
</script>
{% endblock %}
