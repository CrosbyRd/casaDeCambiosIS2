{% extends "base.html" %}
{% block title %}Crear cuenta ‚Äî Global Exchange{% endblock %}
{% block header_auth %}{% endblock %}

{% block content %}
<main id="main" class="max-w-[1200px] mx-auto px-6 py-8">
  <h1 class="h1 mb-6">Crear cuenta</h1>

  <!-- Alineaci√≥n con el panel derecho -->
  <div class="grid md:grid-cols-2 gap-6 items-start">
    <form id="signupForm" class="border border-neutral-200 rounded-lg p-6"
          method="post" action="{% url 'usuarios:register' %}" novalidate>
      {% csrf_token %}

      <div class="mb-6">
        <label class="block mb-3 font-medium" for="id_email">Email</label>
        <input id="id_email" name="email" type="email"
               value="{{ form.email.value|default_if_none:'' }}"
               class="w-full h-11 px-4 border border-neutral-300 rounded-md focus-visible:ring-4 focus-visible:ring-brand"
               placeholder="tu@correo.com" autofocus />
      </div>

      <div class="mb-6">
        <label class="block mb-3 font-medium" for="id_password">Contrase√±a</label>
        <input id="id_password" name="password" type="password"
               class="w-full h-11 px-4 border border-neutral-300 rounded-md focus-visible:ring-4 focus-visible:ring-brand"
               placeholder="Ingresa tu contrase√±a" />
      </div>

      <div class="mb-6">
        <label class="inline-flex items-center gap-3">
          <input id="id_terms" name="terms" type="checkbox" class="h-5 w-5"
                 {% if form.terms.value %}checked{% endif %} />
          <span>Acepto <a class="text-brand hover:underline" href="{% url 'site_legal' %}">t√©rminos y privacidad</a></span>
        </label>
      </div>

      <button class="btn w-full" type="submit">Registrarme</button>
      <a href="{% url 'login' %}" class="btn-secondary mt-6 w-full inline-flex justify-center">Ya tengo cuenta</a>
    </form>

    <!-- Panel informativo al estilo del login -->
    <aside class="border border-neutral-200 rounded-lg p-6 bg-white self-start">
      <h2 class="h2 mb-3">Verificaci√≥n por correo electr√≥nico</h2>
      <p class="text-neutral-700">
        Para activar tu cuenta, te enviaremos un <strong>enlace de verificaci√≥n</strong> al email que registres.
      </p>

      <ul class="mt-4 space-y-2 text-neutral-700">
        <li class="flex gap-3">
          <span class="select-none">‚úâÔ∏è</span>
          Recibir√°s un mensaje en tu bandeja de entrada con el enlace.
        </li>
        <li class="flex gap-3">
          <span class="select-none">üîó</span>
          El enlace es de <strong>un solo uso</strong> y sirve para confirmar tu direcci√≥n.
        </li>
        <li class="flex gap-3">
          <span class="select-none">üß≠</span>
          Aseg√∫rate de escribir bien tu direcci√≥n antes de registrarte.
        </li>
      </ul>

      <div class="mt-6 rounded-xl border border-purple-200 bg-purple-50 px-4 py-3 text-purple-800">
        Si no te llega el c√≥digo, revisa tu carpeta de spam o solicita reenviar desde la pantalla de verificaci√≥n.
      </div>
    </aside>
  </div>

  <!-- Modal de error -->
  <div id="signupError" class="modal {% if form.errors %}block{% else %}hidden{% endif %}">
    <div class="modal-overlay" data-modal-overlay tabindex="-1" aria-hidden="true"></div>
    <div class="w-full h-full flex items-center justify-center p-6">
      <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="signupErrTitle">
        <h2 id="signupErrTitle" class="h2 mb-4">Datos incompletos o incorrectos</h2>
        {% if form.errors %}
          <ul class="text-neutral-700 mb-6 list-disc pl-5">
            {% for field in form %}
              {% for error in field.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-neutral-700 mb-6">Email, contrase√±a y aceptaci√≥n de t√©rminos son obligatorios.</p>
        {% endif %}
        <div class="flex gap-3 justify-end">
          <button class="btn" data-modal-close="signupError">Entendido</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de registro pendiente o √©xito -->
  <div id="signupOK" class="modal hidden">
    <div class="modal-overlay" data-modal-overlay tabindex="-1" aria-hidden="true"></div>
    <div class="w-full h-full flex items-center justify-center p-6">
      <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="signupOkTitle">
        <h2 id="signupOkTitle" class="h2 mb-4">Registro pendiente</h2>
        <p class="text-neutral-700 mb-6">Se ha enviado un c√≥digo de verificaci√≥n a tu correo. Revisa tu bandeja de entrada para activar la cuenta.</p>
        <div class="flex gap-3 justify-end">
          <a class="btn-secondary" href="{% url 'usuarios:verify' %}">Verificar ahora</a>
          <button class="btn" data-modal-close="signupOK">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

</main>

<script>
  const form = document.getElementById('signupForm');
  const modalErr = document.getElementById('signupError');
  const modalOK  = document.getElementById('signupOK');

  form.addEventListener('submit', function(e){
    const email = document.getElementById('id_email').value.trim();
    const pass  = document.getElementById('id_password').value.trim();
    const terms = document.getElementById('id_terms').checked;

    if (!email || !pass || !terms) {
      e.preventDefault();
      modalErr.classList.remove('hidden');
    } else {
      // Env√≠o normal al backend
    }
  });

  // Cierre de modales
  document.addEventListener('click', (e) => {
    const overlay = e.target?.closest('[data-modal-overlay]');
    const closeId = e.target?.closest('[data-modal-close]')?.getAttribute('data-modal-close');
    if (overlay) overlay.closest('.modal')?.classList.add('hidden');
    if (closeId) document.getElementById(closeId)?.classList.add('hidden');
  });
</script>
{% endblock %}
