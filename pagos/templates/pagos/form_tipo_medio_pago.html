{% extends "base.html" %}
{% block title %}Global Exchange{% endblock %}

{% block content %}
<main class="max-w-5xl mx-auto px-6 py-10">

  <!-- Encabezado -->
  <header class="mb-6">
    <h1 class="text-4xl font-extrabold mb-2 text-[var(--ink)]">‚ûï {{ accion }} Tipo de Medio de Pago</h1>
    <p class="text-lg leading-relaxed max-w-2xl text-[var(--muted)]">
      Completa la informaci√≥n para registrar un nuevo tipo de medio de pago en el sistema.
    </p>
  </header>

  <!-- Caja principal con el mismo patr√≥n visual que ‚ÄúAgregar Cotizaci√≥n‚Äù -->
  <section class="bg-white border rounded-xl shadow-sm overflow-hidden" style="border-color:var(--line)">
    <form method="post" novalidate>
      {% csrf_token %}

      <style>
        .form-slab input[type="text"],
        .form-slab input[type="number"],
        .form-slab input[type="checkbox"],
        .form-slab select, .form-slab textarea {
          width: 100%;
          border: 1.5px solid var(--line);
          border-radius: 12px;
          padding: 12px 14px;
          height: 48px;
          font-size: 1rem;
          color: var(--ink);
          background: #fff;
          box-shadow: 0 1px 2px rgba(0,0,0,.03);
          transition: box-shadow .2s ease, border-color .2s ease;
        }
        .form-slab input[type="checkbox"]{ height: 20px; width: 20px; padding: 0; border-radius: 6px; }
        .form-slab input:focus, .form-slab select:focus, .form-slab textarea:focus{
          outline: none; border-color: var(--brand);
          box-shadow: 0 0 0 3px rgba(115,60,255,.15);
        }
        .form-slab select[disabled]{ background:#f3f4f6; color:#6b7280; cursor:not-allowed; }
        .help { font-size:.9rem; color:var(--muted); margin-top:.35rem }
        .err  { color:#991b1b; background:#fee2e2; border:1px solid #fecaca; padding:.5rem .75rem; border-radius:.5rem; }
      </style>

      <div class="form-slab">
        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead class="bg-[var(--brand)] text-white">
              <tr><th class="px-4 py-3 text-left">Nombre</th></tr>
            </thead>
            <tbody>
              <tr class="border-b" style="border-color:var(--line)">
                <td class="px-4 py-4">
                  {% with current_name=form.nombre.value|default:form.instance.nombre %}
                    <!-- Men√∫ desplegable para Nombre (bloqueado en edici√≥n) -->
                    <select name="nombre" id="id_nombre" {% if form.instance.pk %}disabled="disabled"{% endif %}>
                      <option value="">-- Selecciona una opci√≥n --</option>
                      <option value="Tarjeta de Credito" {% if current_name == "Tarjeta de Credito" %}selected{% endif %}>Tarjeta de Credito</option>
                      <option value="Transferencia Bancaria" {% if current_name == "Transferencia Bancaria" %}selected{% endif %}>Transferencia Bancaria</option>
                      <option value="Billetera Electronica" {% if current_name == "Billetera Electronica" %}selected{% endif %}>Billetera Electronica</option>
                      <option value="Cheque" {% if current_name == "Cheque" %}selected{% endif %}>Cheque</option>
                      <option value="Cheque Adelantado" {% if current_name == "Cheque Adelantado" %}selected{% endif %}>Cheque Adelantado</option>
                    </select>

                    {% if form.instance.pk %}
                      <!-- Como el select est√° deshabilitado en edici√≥n, enviamos el valor real con un hidden -->
                      <input type="hidden" name="nombre" value="{{ current_name }}">
                      <div class="help">El nombre no puede modificarse en edici√≥n.</div>
                    {% else %}
                      <div class="help">Selecciona el tipo de medio de pago.</div>
                    {% endif %}
                  {% endwith %}

                  {% if form.nombre.errors %}<div class="err mt-2">{{ form.nombre.errors|join:", " }}</div>{% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead class="bg-[var(--brand)] text-white">
              <tr>
                <th class="px-4 py-3 text-left">Comisi√≥n porcentaje (%)</th>
                <th class="px-4 py-3 text-left">Bonificaci√≥n porcentaje (%)</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b" style="border-color:var(--line)">
                <td class="px-4 py-4">
                  {{ form.comision_porcentaje }}
                  <div class="help">Comisi√≥n en % del monto total (0‚Äì100).</div>
                  {% if form.comision_porcentaje.errors %}<div class="err mt-2">{{ form.comision_porcentaje.errors|join:", " }}</div>{% endif %}
                </td>
                <td class="px-4 py-4">
                  {{ form.bonificacion_porcentaje }}
                  <div class="help">Descuento/bonificaci√≥n en % aplicado (0‚Äì100).</div>
                  {% if form.bonificacion_porcentaje.errors %}<div class="err mt-2">{{ form.bonificacion_porcentaje.errors|join:", " }}</div>{% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead class="bg-[var(--brand)] text-white">
              <tr><th class="px-4 py-3 text-left">Estado</th></tr>
            </thead>
            <tbody>
              <tr>
                <td class="px-4 py-4">
                  <label class="flex items-center gap-3">
                    {{ form.activo }}
                    <span class="font-semibold text-[var(--ink)]">Activo</span>
                  </label>
                  <div class="help">Si est√° desactivado no se podr√° utilizar en operaciones.</div>
                  {% if form.activo.errors %}<div class="err mt-2">{{ form.activo.errors|join:", " }}</div>{% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>

      <!-- Acciones -->
      <div class="flex flex-col sm:flex-row justify-end gap-3 p-4">
        <a href="{% url 'pagos:listar_tipos_medio_pago' %}" class="px-5 py-2 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700">
          Cancelar
        </a>
        <button type="submit" class="px-6 py-2 rounded-lg font-bold text-white shadow-sm" style="background:var(--brand)">
          {% if accion|lower == 'editar' %}
            üíæ Guardar Cambios
          {% elif accion|lower == 'agregar' %}
            ‚ûï Agregar
          {% else %}
            {{ accion }}
          {% endif %}
        </button>
      </div>
    </form>
  </section>
</main>
{% endblock %}

