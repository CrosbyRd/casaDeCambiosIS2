{% extends "base.html" %}
{% block title %}Global Exchange{% endblock %}

{% block content %}
<main class="max-w-6xl mx-auto px-6 py-10">

  <header class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-4xl font-extrabold mb-2" style="color:var(--ink)">ðŸ‘¥ Roles</h1>
      <p class="text-lg leading-relaxed max-w-xl" style="color:var(--muted)">
        GestionÃ¡ los roles del sistema: crear, ver descripciÃ³n, asignar permisos y eliminar.
      </p>
    </div>
    <div class="space-x-3 flex">
      <a href="{% url 'admin_panel:dashboard' %}"
         class="px-4 py-2 rounded-lg font-bold bg-[var(--brand-soft)] hover:brightness-95"
         style="color:var(--brand-dark)">
        â¬… Volver al Panel
      </a>
      <button type="button" id="btn-toggle-crear"
              class="px-4 py-2 rounded-lg font-bold text-white" style="background:var(--brand)">
        âž• Crear Rol
      </button>
    </div>
  </header>

  {% if messages %}
    <div class="mb-6">
      {% for message in messages %}
        <div class="bg-green-500 text-white px-4 py-2 rounded-lg mb-2">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Formulario crear rol -->
  <section id="crearRolForm" class="hidden mb-6 bg-white border rounded-xl shadow-sm p-6" style="border-color:var(--line)">
    <form method="post">
      {% csrf_token %}
      <div class="mb-4">
        <label for="nombre" class="block mb-1 font-semibold">Nombre del Rol</label>
        <input type="text" id="nombre" name="nombre"
               class="w-full border border-gray-300 rounded-lg px-4 py-2" required>
      </div>
      <div class="mb-4">
        <label for="descripcion" class="block mb-1 font-semibold">DescripciÃ³n</label>
        <textarea id="descripcion" name="descripcion" rows="3"
                  class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
      </div>
      <button type="submit" class="px-6 py-2 rounded-lg font-bold text-white" style="background:var(--brand)">
        Guardar Rol
      </button>
    </form>
  </section>

  <!-- Tabla de Roles -->
  <section class="bg-white border rounded-xl shadow-sm overflow-hidden" style="border-color:var(--line)">
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse min-w-[640px]">
        <thead style="background:var(--brand); color:#fff">
          <tr>
            <th class="px-6 py-3">Nombre</th>
            <th class="px-6 py-3">DescripciÃ³n</th>
            <th class="px-6 py-3 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for rol in roles %}
          <tr class="border-b hover:bg-[var(--brand-soft)]" style="border-color:var(--line)">
            <td class="px-6 py-4 font-bold text-[var(--brand-dark)]">{{ rol.name }}</td>
            <td class="px-6 py-4">{{ rol.description|default:"â€”" }}</td>
            <td class="px-6 py-4">
              <div class="flex justify-center gap-2">
                <form action="{% url 'roles:role-delete' rol.pk %}" method="post"
                      onsubmit="return confirm('Â¿EstÃ¡s seguro de que deseas eliminar este rol?');">
                  {% csrf_token %}
                  <button type="submit"
                          class="w-24 text-center px-4 py-2 rounded-md font-semibold text-white bg-red-600 hover:bg-red-700">
                    Eliminar
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="px-6 py-6 text-center" style="color:var(--muted)">No hay roles registrados.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

</main>

<script>
  (function(){
    const btn = document.getElementById('btn-toggle-crear');
    const panel = document.getElementById('crearRolForm');
    if(btn && panel){
      btn.addEventListener('click', ()=> panel.classList.toggle('hidden'));
    }
  })();
</script>
{% endblock %}
