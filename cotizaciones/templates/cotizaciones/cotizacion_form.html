{% extends "base.html" %}

{% block content %}
<section class="container py-10">
  <h1 class="h1 h1--sm mb-6">{% if object %}Editar{% else %}Crear{% endif %} cotización</h1>

  <form method="post" class="box form" novalidate>
    {% csrf_token %}
    {% if form.non_field_errors %}
      <div class="form-alert" role="alert">
        {% for e in form.non_field_errors %}{{ e }}{% if not forloop.last %}<br>{% endif %}{% endfor %}
      </div>
    {% endif %}

    <div class="grid gap-4 md:grid-cols-2">
      <p>
        {{ form.moneda_base.label_tag }}{{ form.moneda_base }}
        {% for e in form.moneda_base.errors %}<span class="text-red-600 text-sm">{{ e }}</span>{% endfor %}
      </p>
      <p>
        {{ form.moneda_destino.label_tag }}{{ form.moneda_destino }}
        {% for e in form.moneda_destino.errors %}<span class="text-red-600 text-sm">{{ e }}</span>{% endfor %}
      </p>
    </div>

    <div class="grid gap-4 md:grid-cols-2">
      <p>
        {{ form.valor_compra.label_tag }}{{ form.valor_compra }}
        {% for e in form.valor_compra.errors %}<span class="text-red-600 text-sm">{{ e }}</span>{% endfor %}
      </p>
      <p>
        {{ form.comision_compra.label_tag }}{{ form.comision_compra }}
        {% for e in form.comision_compra.errors %}<span class="text-red-600 text-sm">{{ e }}</span>{% endfor %}
      </p>
    </div>

    <div class="grid gap-4 md:grid-cols-2">
      <p>
        {{ form.valor_venta.label_tag }}{{ form.valor_venta }}
        {% for e in form.valor_venta.errors %}<span class="text-red-600 text-sm">{{ e }}</span>{% endfor %}
      </p>
      <p>
        {{ form.comision_venta.label_tag }}{{ form.comision_venta }}
        {% for e in form.comision_venta.errors %}<span class="text-red-600 text-sm">{{ e }}</span>{% endfor %}
      </p>
    </div>

    {% if form.fecha_actualizacion %}
      <p>
        {{ form.fecha_actualizacion.label_tag }}{{ form.fecha_actualizacion }}
        {% for e in form.fecha_actualizacion.errors %}<span class="text-red-600 text-sm">{{ e }}</span>{% endfor %}
      </p>
    {% endif %}

    <div class="actions">
      <button class="btn w-full" type="submit">{% if object %}Actualizar{% else %}Crear{% endif %}</button>
      <a class="btn-ghost" href="{% url 'cotizaciones:cotizacion_list' %}">Volver</a>
    </div>
  </form>
</section>

<script>
  // Preview simple de totales (si los campos existen)
  (function(){
    const $ = id => document.getElementById(id);
    const v = id => parseFloat(($(id)?.value||'').replace(',', '.')) || 0;
    const vc = document.getElementById('id_valor_compra');
    const cc = document.getElementById('id_comision_compra');
    const vv = document.getElementById('id_valor_venta');
    const cv = document.getElementById('id_comision_venta');
    if(!(vc && cc && vv && cv)) return;
    [vc,cc,vv,cv].forEach(el=>el.addEventListener('input', ()=>{})); // hook si luego querés mostrar totales
  })();
</script>
{% endblock %}
