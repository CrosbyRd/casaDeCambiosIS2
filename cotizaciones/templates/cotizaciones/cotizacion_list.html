{% extends "base.html" %}
{% load static l10n %}

{% block title %}Listado de Cotizaciones â€” Global Exchange{% endblock %}

{% block content %}
<main class="mx-auto px-4 py-8 max-w-5xl">

  {% if messages %}
  <div class="mb-4">
    {% for message in messages %}
      <div class="bg-green-500 text-white px-3 py-2 rounded-lg mb-2 text-sm">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <header class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-extrabold mb-1" style="color:var(--ink)">Cotizaciones</h1>
      <p class="text-base leading-relaxed max-w-xl" style="color:var(--muted)">
        AquÃ­ puedes gestionar todas las cotizaciones registradas en el sistema.
      </p>
    </div>
    <div class="space-x-2 flex">
      <a href="{% url 'admin_panel:dashboard' %}"
         class="px-3 py-2 rounded-lg font-semibold bg-[var(--brand-soft)] hover:brightness-95 text-sm"
         style="color:var(--brand-dark)">â¬… Volver</a>
      <a href="{% url 'cotizaciones:cotizacion_create' %}"
         class="px-3 py-2 rounded-lg font-bold text-white text-sm"
         style="background:var(--brand)">âž• Agregar</a>
    </div>
  </header>

  <section class="bg-white border rounded-xl shadow-sm overflow-hidden" style="border-color:var(--line)">
    <table class="min-w-full text-left border-collapse text-sm tbl-tight">
      <thead style="background:var(--brand); color:#fff">
        <tr>
          <th class="px-3 py-2">Moneda Destino</th>
          <th class="px-3 py-2 text-center w-28">Compra</th>
          <th class="px-3 py-2 text-center w-28">Venta</th>
          <th class="px-3 py-2 text-center w-40">Ãšltima ActualizaciÃ³n</th>
          <th class="px-3 py-2 text-center w-40">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for c in cotizaciones %}
        <tr class="border-b hover:bg-[var(--brand-soft)]" style="border-color:var(--line)">
          <td class="px-3 py-2">
            <span class="currency-emoji" data-code="{{ c.moneda_destino.codigo }}"></span>
            <span class="nowrap">{{ c.moneda_destino.nombre }} ({{ c.moneda_destino.simbolo }})</span>
          </td>

          <td class="px-3 py-2 text-center font-bold nowrap">
            {{ c.total_compra|unlocalize|floatformat:0 }} â‚²
          </td>
          <td class="px-3 py-2 text-center font-bold nowrap">
            {{ c.total_venta|unlocalize|floatformat:0 }} â‚²
          </td>

          <td class="px-3 py-2 text-center nowrap">
            {{ c.fecha_actualizacion|date:"d/m/Y H:i" }}
          </td>
          <td class="px-3 py-2">
            <div class="flex justify-center gap-2">
              <a href="{% url 'cotizaciones:cotizacion_update' c.id %}"
                 class="min-w-[4.5rem] text-center px-3 py-1.5 rounded-md font-semibold bg-[var(--brand-soft)] text-[var(--brand-dark)] hover:brightness-95">
                Editar
              </a>
              <a href="{% url 'cotizaciones:cotizacion_delete' c.id %}"
                 class="min-w-[4.5rem] text-center px-3 py-1.5 rounded-md font-semibold text-white bg-red-600 hover:bg-red-700">
                Eliminar
              </a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="px-3 py-4 text-center" style="color:var(--muted)">
            No hay cotizaciones registradas.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</main>

<style>
  /* compacta aÃºn mÃ¡s la tabla */
  .tbl-tight { table-layout: fixed; }
  .nowrap { white-space: nowrap; }
</style>

<script>
  (function(){
    const MAP = {USD:"ðŸ‡ºðŸ‡¸", EUR:"ðŸ‡ªðŸ‡º", ARS:"ðŸ‡¦ðŸ‡·", BRL:"ðŸ‡§ðŸ‡·", CLP:"ðŸ‡¨ðŸ‡±", COP:"ðŸ‡¨ðŸ‡´",
                 MXN:"ðŸ‡²ðŸ‡½", PEN:"ðŸ‡µðŸ‡ª", PYG:"ðŸ‡µðŸ‡¾", UYU:"ðŸ‡ºðŸ‡¾", GBP:"ðŸ‡¬ðŸ‡§", JPY:"ðŸ‡¯ðŸ‡µ",
                 CNY:"ðŸ‡¨ðŸ‡³", AUD:"ðŸ‡¦ðŸ‡º", CAD:"ðŸ‡¨ðŸ‡¦", CHF:"ðŸ‡¨ðŸ‡­"};
    document.querySelectorAll('.currency-emoji').forEach(el=>{
      const code = String(el.dataset.code||'').toUpperCase();
      el.textContent = (MAP[code] || "ðŸ’±") + " ";
    });
  })();
</script>
{% endblock %}
