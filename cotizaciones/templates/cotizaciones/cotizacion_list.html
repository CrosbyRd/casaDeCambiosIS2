{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Listado de Cotizaciones â€” Global Exchange</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>

  <main class="container container--tight">
      {% if messages %}
      <div style="margin-bottom: 1rem;">
        {% for message in messages %}
          <div style="background: #22c55e; color: white; padding: .75rem 1rem; border-radius: .5rem; margin-bottom: .5rem;">
            {{ message }}
          </div>
        {% endfor %}
          </div>
      {% endif %}


    <!-- Encabezado -->
    <header class="page-header page-header--tight" style="text-align: center; margin-bottom: 1rem;">
      <h1 class="h1 h1--sm">Cotizaciones</h1>
    </header>

    <!-- Tabla mÃ¡s compacta y centrada -->
    <section class="box box--tight no-padding" style="display: flex; justify-content: center;">
      <div style="overflow-x: auto;">
        <table class="table table--compact"
              id="cotizaciones-table"
              style="width: auto; margin: 0 auto; border-collapse: collapse; border: 2px solid var(--brand);">
          <thead style="background-color: var(--brand); color: white;">
            <tr>
              <th style="padding: .75rem; border: 1px solid var(--brand); white-space: nowrap;">Moneda Base</th>
              <th style="padding: .75rem; border: 1px solid var(--brand); white-space: nowrap;">Moneda Destino</th>
              <th style="padding: .75rem; border: 1px solid var(--brand); white-space: nowrap;">Valor de Compra</th>
              <th style="padding: .75rem; border: 1px solid var(--brand); white-space: nowrap;">Valor de Venta</th>
              <th style="padding: .75rem; border: 1px solid var(--brand); white-space: nowrap;">Ãšltima ActualizaciÃ³n</th>
              <th style="padding: .75rem; border: 1px solid var(--brand); white-space: nowrap;">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for c in cotizaciones %}
            <tr>
              <td style="border: 1px solid var(--brand);" class="cell-strong">
                <span class="currency-emoji" data-code="{{ c.moneda_base.codigo }}"></span>
                {{ c.moneda_base.nombre }} ({{ c.moneda_base.simbolo }})
              </td>
              <td style="border: 1px solid var(--brand);" class="cell-strong">
                <span class="currency-emoji" data-code="{{ c.moneda_destino.codigo }}"></span>
                {{ c.moneda_destino.nombre }} ({{ c.moneda_destino.simbolo }})
              </td>
              <td style="border: 1px solid var(--brand);">{{ c.valor_compra }}</td>
              <td style="border: 1px solid var(--brand);">{{ c.valor_venta }}</td>
              <td style="border: 1px solid var(--brand);">{{ c.fecha_actualizacion }}</td>
              <td style="border: 1px solid var(--brand);">
                <div style="display: inline-flex; gap: 0.5rem;">
                  <a href="{% url 'cotizaciones:cotizacion_update' c.id %}" class="btn-secondary">Editar</a>
                  <a href="{% url 'cotizaciones:cotizacion_delete' c.id %}" 
                    style="background-color: #dc2626; color: white; padding: .6rem 1rem; border-radius: .75rem; font-weight: 700; text-decoration: none; display: inline-block;">
                    Eliminar
                  </a>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="empty" style="border: 1px solid var(--brand);">No hay cotizaciones registradas.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- Botones alineados con Moneda Base/Destino -->
        <div style="display: flex; justify-content: flex-start; gap: 0.75rem; margin-top: 1rem; margin-left: 0;">
          <a href="{% url 'cotizaciones:cotizacion_create' %}" class="btn">Agregar CotizaciÃ³n</a>
          <a href="{% url 'admin_panel:dashboard' %}" 
             style="background-color: #dc2626; color: white; padding: .85rem 1.2rem; border-radius: .9rem; font-weight: 800; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; transition: background .2s ease;">
            Volver
          </a>
        </div>

      </div>
    </section>
  </main>

  <!-- Mapa de emojis por cÃ³digo de moneda -->
  <script>
    (function(){
      const MAP = {
        USD:"ðŸ‡ºðŸ‡¸", EUR:"ðŸ‡ªðŸ‡º", ARS:"ðŸ‡¦ðŸ‡·", BRL:"ðŸ‡§ðŸ‡·", CLP:"ðŸ‡¨ðŸ‡±", COP:"ðŸ‡¨ðŸ‡´",
        MXN:"ðŸ‡²ðŸ‡½", PEN:"ðŸ‡µðŸ‡ª", PYG:"ðŸ‡µðŸ‡¾", UYU:"ðŸ‡ºðŸ‡¾", GBP:"ðŸ‡¬ðŸ‡§", JPY:"ðŸ‡¯ðŸ‡µ",
        CNY:"ðŸ‡¨ðŸ‡³", AUD:"ðŸ‡¦ðŸ‡º", CAD:"ðŸ‡¨ðŸ‡¦", CHF:"ðŸ‡¨ðŸ‡­"
      };
      document.querySelectorAll('.currency-emoji').forEach(el => {
        const code = String(el.dataset.code || '').toUpperCase();
        el.textContent = (MAP[code] || "ðŸ’±") + " ";
      });
    })();
  </script>

</body>
</html>
