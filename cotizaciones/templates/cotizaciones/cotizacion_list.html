{% extends "base.html" %}
{% load static %}

{% block title %}Listado de Cotizaciones ‚Äî Global Exchange{% endblock %}

{% block content %}
<main class="w-full mx-auto px-6 py-10">

  <!-- Mensajes -->
  {% if messages %}
  <div class="mb-6">
    {% for message in messages %}
      <div class="bg-green-500 text-white px-4 py-2 rounded-lg mb-2">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

<header class="flex items-center justify-between mb-8">
  <div class="pl-12">  <!-- üëà a√±ade espacio a la izquierda -->
    <h1 class="text-4xl font-extrabold mb-2" style="color:var(--ink)"> Cotizaciones</h1>
    <p class="text-lg leading-relaxed max-w-xl" style="color:var(--muted)">
      Aqu√≠ puedes gestionar todas las cotizaciones registradas en el sistema: crea nuevas, edita las existentes o elim√≠nalas seg√∫n sea necesario.
    </p>
  </div>
  <div class="space-x-3 flex">
    <a href="{% url 'admin_panel:dashboard' %}" 
       class="px-4 py-2 rounded-lg font-bold bg-[var(--brand-soft)] hover:brightness-95"
       style="color:var(--brand-dark)">
      ‚¨Ö Volver al Panel
    </a>
    <a href="{% url 'cotizaciones:cotizacion_create' %}" 
       class="px-4 py-2 rounded-lg font-bold text-white"
       style="background:var(--brand)">
      ‚ûï Agregar Cotizaci√≥n
    </a>
  </div>
</header>


<!-- Tabla -->
<section class="bg-white border rounded-xl shadow-sm overflow-hidden" style="border-color:var(--line)">
   <table class="min-w-full text-left border-collapse">
    <thead style="background:var(--brand); color:#fff">
      <tr>
        <th class="px-6 py-3">Moneda Base</th>
        <th class="px-6 py-3">Moneda Destino</th>
        <th class="px-6 py-3 text-center">Valor Compra</th>
        <th class="px-6 py-3 text-center">Comisi√≥n Compra</th>
        <th class="px-6 py-3 text-center">Total Compra</th>
        <th class="px-6 py-3 text-center">Valor Venta</th>
        <th class="px-6 py-3 text-center">Comisi√≥n Venta</th>
        <th class="px-6 py-3 text-center">Total Venta</th>
        <th class="px-6 py-3 text-center">√öltima Actualizaci√≥n</th>
        <th class="px-6 py-3 text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for c in cotizaciones %}
      <tr class="border-b hover:bg-[var(--brand-soft)]" style="border-color:var(--line)">
        <td class="px-6 py-4 font-semibold text-[var(--ink)]">
          <span class="currency-emoji" data-code="{{ c.moneda_base.codigo }}"></span>
          {{ c.moneda_base.nombre }} ({{ c.moneda_base.simbolo }})
        </td>
        <td class="px-6 py-4">
          <span class="currency-emoji" data-code="{{ c.moneda_destino.codigo }}"></span>
          {{ c.moneda_destino.nombre }} ({{ c.moneda_destino.simbolo }})
        </td>
        <td class="px-6 py-4 text-center">{{ c.valor_compra }}</td>
        <td class="px-6 py-4 text-center">{{ c.comision_compra }}</td>
        <td class="px-6 py-4 text-center font-bold">{{ c.total_compra }}</td>
        <td class="px-6 py-4 text-center">{{ c.valor_venta }}</td>
        <td class="px-6 py-4 text-center">{{ c.comision_venta }}</td>
        <td class="px-6 py-4 text-center font-bold">{{ c.total_venta }}</td>
        <td class="px-6 py-4 text-center">{{ c.fecha_actualizacion }}</td>
        <td class="px-6 py-4">
          <div class="flex justify-center gap-2">
            <!-- Bot√≥n Editar -->
            <a href="{% url 'cotizaciones:cotizacion_update' c.id %}" 
              class="w-24 text-center px-4 py-2 rounded-md font-semibold bg-[var(--brand-soft)] text-[var(--brand-dark)] hover:brightness-95">
              Editar
            </a>
            <!-- Bot√≥n Eliminar -->
            <a href="{% url 'cotizaciones:cotizacion_delete' c.id %}" 
              class="w-24 text-center px-4 py-2 rounded-md font-semibold text-white bg-red-600 hover:bg-red-700">
              Eliminar
            </a>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="10" class="px-6 py-6 text-center" style="color:var(--muted)">
          No hay cotizaciones registradas.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>

</main>

<!-- Script para banderas -->
<script>
  (function(){
    const MAP = {
      USD:"üá∫üá∏", EUR:"üá™üá∫", ARS:"üá¶üá∑", BRL:"üáßüá∑", CLP:"üá®üá±", COP:"üá®üá¥",
      MXN:"üá≤üáΩ", PEN:"üáµüá™", PYG:"üáµüáæ", UYU:"üá∫üáæ", GBP:"üá¨üáß", JPY:"üáØüáµ",
      CNY:"üá®üá≥", AUD:"üá¶üá∫", CAD:"üá®üá¶", CHF:"üá®üá≠"
    };
    document.querySelectorAll('.currency-emoji').forEach(el => {
      const code = String(el.dataset.code || '').toUpperCase();
      el.textContent = (MAP[code] || "üí±") + " ";
    });
  })();
</script>
{% endblock %}
