{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Listado de Cotizaciones â€” Global Exchange</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <style>
        .total-row {
            background-color: #f8f9fa;
            font-weight: bold;
        }
    </style>
</head>
<body>

  <main class="container container--tight">
      {% if messages %}
      <div style="margin-bottom: 1rem;">
        {% for message in messages %}
          <div style="background: #22c55e; color: white; padding: .75rem 1rem; border-radius: .5rem; margin-bottom: .5rem;">
            {{ message }}
          </div>
        {% endfor %}
          </div>
      {% endif %}


    <!-- Encabezado -->
    <header class="page-header page-header--tight" style="text-align: center; margin-bottom: 1rem;">
      <h1 class="h1 h1--sm">Cotizaciones</h1>
    </header>

        <section class="box box--tight no-padding">
            <div class="table-scroll table-wrap--max">
                <table class="table table--compact" id="cotizaciones-table">
                    <thead>
                        <tr>
                            <th>Moneda Base</th>
                            <th>Moneda Destino</th>
                            <th>Valor Compra</th>
                            <th>ComisiÃ³n Compra</th>
                            <th>Total Compra</th>
                            <th>Valor Venta</th>
                            <th>ComisiÃ³n Venta</th>
                            <th>Total Venta</th>
                            <th>Ãšltima ActualizaciÃ³n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in cotizaciones %}
                        <tr>
                            <td class="cell-strong">
                                <span class="currency-emoji" data-code="{{ c.moneda_base.codigo }}"></span>
                                {{ c.moneda_base.nombre }} ({{ c.moneda_base.simbolo }})
                            </td>
                            <td class="cell-strong">
                                <span class="currency-emoji" data-code="{{ c.moneda_destino.codigo }}"></span>
                                {{ c.moneda_destino.nombre }} ({{ c.moneda_destino.simbolo }})
                            </td>
                            <td>{{ c.valor_compra }}</td>
                            <td>{{ c.comision_compra }}</td>
                            <td class="total-row">{{ c.total_compra }}</td>
                            <td>{{ c.valor_venta }}</td>
                            <td>{{ c.comision_venta }}</td>
                            <td class="total-row">{{ c.total_venta }}</td>
                            <td>{{ c.fecha_actualizacion }}</td>
                            <td>
                                <div style="display: inline-flex; gap: 0.5rem;">
                                    <a href="{% url 'cotizaciones:cotizacion_update' c.id %}" class="btn-secondary" style="display: inline-block;">Editar</a>
                                    <a href="{% url 'cotizaciones:cotizacion_delete' c.id %}" class="btn-ghost" style="display: inline-block;">Eliminar</a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="10" class="empty">No hay cotizaciones registradas.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Mapa de emojis por cÃ³digo de moneda -->
    <script>
        (function(){
            const MAP = {
                USD:"ðŸ‡ºðŸ‡¸", EUR:"ðŸ‡ªðŸ‡º", ARS:"ðŸ‡¦ðŸ‡·", BRL:"ðŸ‡§ðŸ‡·", CLP:"ðŸ‡¨ðŸ‡±", COP:"ðŸ‡¨ðŸ‡´",
                MXN:"ðŸ‡²ðŸ‡½", PEN:"ðŸ‡µðŸ‡ª", PYG:"ðŸ‡µðŸ‡¾", UYU:"ðŸ‡ºðŸ‡¾", GBP:"ðŸ‡¬ðŸ‡§", JPY:"ðŸ‡¯ðŸ‡µ",
                CNY:"ðŸ‡¨ðŸ‡³", AUD:"ðŸ‡¦ðŸ‡º", CAD:"ðŸ‡¨ðŸ‡¦", CHF:"ðŸ‡¨ðŸ‡­"
            };
            document.querySelectorAll('.currency-emoji').forEach(el => {
                const code = String(el.dataset.code || '').toUpperCase();
                el.textContent = (MAP[code] || "ðŸ’±") + " ";
            });
        })();
    </script>
</body>
</html>