{% extends "base.html" %}

{% block extra_head %}
<style>.total-row{background-color:#f8f9fa;font-weight:bold}</style>
{% endblock %}

{% block content %}
<main class="container container--tight mx-auto py-10">
  <header class="page-header page-header--tight flex items-center justify-between mb-6">
    <h1 class="h1 h1--sm">Cotizaciones</h1>
    <a href="{% url 'cotizaciones:cotizacion_create' %}" class="btn">Agregar Cotización</a>
  </header>

  <section class="box box--tight no-padding">
    <div class="table-scroll table-wrap--max">
      <table class="table table--compact" id="cotizaciones-table">
        <thead>
          <tr>
            <th>Moneda Base</th>
            <th>Moneda Destino</th>
            <th>Valor Compra</th>
            <th>Comisión Compra</th>
            <th>Total Compra</th>
            <th>Valor Venta</th>
            <th>Comisión Venta</th>
            <th>Total Venta</th>
            <th>Última Actualización</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for c in cotizaciones %}
          <tr>
            <td class="cell-strong">
              <span class="currency-emoji" data-code="{{ c.moneda_base.codigo }}"></span>
              {{ c.moneda_base.nombre }} ({{ c.moneda_base.simbolo }})
            </td>
            <td class="cell-strong">
              <span class="currency-emoji" data-code="{{ c.moneda_destino.codigo }}"></span>
              {{ c.moneda_destino.nombre }} ({{ c.moneda_destino.simbolo }})
            </td>
            <td>{{ c.valor_compra }}</td>
            <td>{{ c.comision_compra }}</td>
            <td class="total-row">{{ c.total_compra }}</td>
            <td>{{ c.valor_venta }}</td>
            <td>{{ c.comision_venta }}</td>
            <td class="total-row">{{ c.total_venta }}</td>
            <td>{{ c.fecha_actualizacion }}</td>
            <td>
              <div class="action-row">
                <a href="{% url 'cotizaciones:cotizacion_update' c.id %}" class="btn-secondary">Editar</a>
                <a href="{% url 'cotizaciones:cotizacion_delete' c.id %}" class="btn-ghost">Eliminar</a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="10" class="empty">No hay cotizaciones registradas.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</main>

<script>
  (function(){
    const MAP={USD:"🇺🇸",EUR:"🇪🇺",ARS:"🇦🇷",BRL:"🇧🇷",CLP:"🇨🇱",COP:"🇨🇴",MXN:"🇲🇽",PEN:"🇵🇪",PYG:"🇵🇾",UYU:"🇺🇾",GBP:"🇬🇧",JPY:"🇯🇵",CNY:"🇨🇳",AUD:"🇦🇺",CAD:"🇨🇦",CHF:"🇨🇭"};
    document.querySelectorAll('.currency-emoji').forEach(el=>{
      const code=String(el.dataset.code||'').toUpperCase();
      el.textContent=(MAP[code]||"💱")+" ";
    });
  })();
</script>
{% endblock %}
