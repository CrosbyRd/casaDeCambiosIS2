{% extends "base.html" %}
{% load static %}

{% block title %}Listado de Cotizaciones ‚Äî Global Exchange{% endblock %}

{% block content %}
<main class="max-w-[1200px] mx-auto px-6 py-10">
  {% if messages %}
  <div style="margin-bottom: 1rem;">
    {% for message in messages %}
      <div style="background: #22c55e; color: white; padding: .75rem 1rem; border-radius: .5rem; margin-bottom: .5rem;">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Encabezado -->
  <header class="page-header text-center mb-6">
    <h1 class="text-4xl font-bold">Cotizaciones</h1>
  </header>

  <!-- Tabla centrada -->
  <div class="flex justify-center w-full">
    <table class="table table--compact max-w-[1200px] w-full"
           id="cotizaciones-table"
           style="margin: 0 auto; border-collapse: collapse; border: 2px solid var(--brand);">
        <thead class="bg-[#6d28d9] text-white">
          <tr>
            <th class="px-12 py-3 border border-[#6d28d9]">Moneda Base</th>
            <th class="px-12 py-3 border border-[#6d28d9]">Moneda Destino</th>
            <th class="px-8 py-3 border border-[#6d28d9]">Valor Compra</th>
            <th class="px-8 py-3 border border-[#6d28d9]">Comisi√≥n Compra</th>
            <th class="px-8 py-3 border border-[#6d28d9]">Total Compra</th>
            <th class="px-8 py-3 border border-[#6d28d9]">Valor Venta</th>
            <th class="px-8 py-3 border border-[#6d28d9]">Comisi√≥n Venta</th>
            <th class="px-8 py-3 border border-[#6d28d9]">Total Venta</th>
            <th class="px-14 py-3 border border-[#6d28d9]">√öltima Actualizaci√≥n</th>
            <th class="px-6 py-3 border border-[#6d28d9]">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for c in cotizaciones %}
          <tr>
            <td class="border border-[#6d28d9] px-12 py-3">
              <span class="currency-emoji" data-code="{{ c.moneda_base.codigo }}"></span>
              {{ c.moneda_base.nombre }} ({{ c.moneda_base.simbolo }})
            </td>
            <td class="border border-[#6d28d9] px-12 py-3">
              <span class="currency-emoji" data-code="{{ c.moneda_destino.codigo }}"></span>
              {{ c.moneda_destino.nombre }} ({{ c.moneda_destino.simbolo }})
            </td>
            <td class="border border-[#6d28d9] text-center px-8">{{ c.valor_compra }}</td>
            <td class="border border-[#6d28d9] text-center px-8">{{ c.comision_compra }}</td>
            <td class="border border-[#6d28d9] text-center font-bold px-8">{{ c.total_compra }}</td>
            <td class="border border-[#6d28d9] text-center px-8">{{ c.valor_venta }}</td>
            <td class="border border-[#6d28d9] text-center px-8">{{ c.comision_venta }}</td>
            <td class="border border-[#6d28d9] text-center font-bold px-8">{{ c.total_venta }}</td>
            <td class="border border-[#6d28d9] text-center px-14">{{ c.fecha_actualizacion }}</td>
            <td class="border border-[#6d28d9] px-6 py-3">
              <div class="inline-flex gap-2">
                <a href="{% url 'cotizaciones:cotizacion_update' c.id %}" class="btn-secondary">Editar</a>
                <a href="{% url 'cotizaciones:cotizacion_delete' c.id %}" 
                  class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-bold flex items-center justify-center">
                  Eliminar
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>


    </table>
  </div>

  <!-- Botones -->
  <div class="flex justify-start gap-4 mt-6 ml-2">
    <a href="{% url 'cotizaciones:cotizacion_create' %}" 
      class="btn px-6 py-2 rounded-xl">Agregar Cotizaci√≥n</a>
    <a href="{% url 'admin_panel:dashboard' %}" 
      class="bg-red-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-red-700 flex items-center justify-center">
      Volver
    </a>
  </div>
</main>

<script>
  (function(){
    const MAP = {
      USD:"üá∫üá∏", EUR:"üá™üá∫", ARS:"üá¶üá∑", BRL:"üáßüá∑", CLP:"üá®üá±", COP:"üá®üá¥",
      MXN:"üá≤üáΩ", PEN:"üáµüá™", PYG:"üáµüáæ", UYU:"üá∫üáæ", GBP:"üá¨üáß", JPY:"üáØüáµ",
      CNY:"üá®üá≥", AUD:"üá¶üá∫", CAD:"üá®üá¶", CHF:"üá®üá≠"
    };
    document.querySelectorAll('.currency-emoji').forEach(el => {
      const code = String(el.dataset.code || '').toUpperCase();
      el.textContent = (MAP[code] || "üí±") + " ";
    });
  })();
</script>
{% endblock %}
